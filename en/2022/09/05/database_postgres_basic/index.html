<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta name=generator content="Hugo 0.105.0"><meta charset=utf-8><title>PostgreSQL 基础与实践 · Pseudoyu</title><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><script data-goatcounter=https://stats.pseudoyu.com/count async src=//stats.pseudoyu.com/count.js></script><meta name=description content="《后来的我们 - 五月天》 前言 最近想着把工作中常用到的技术点与工具做一些整理总结，一方面梳理一下这些知识点，加深使用记忆，也可以作为之后使用的查"><meta name=keywords content="hugo,blockchain,programming"><link rel=canonical href=https://www.pseudoyu.com/en/2022/09/05/database_postgres_basic/><link rel=alternate href=https://www.pseudoyu.com/zh/2022/09/05/database_postgres_basic/ hreflang=zh><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css integrity=sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css integrity=sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ crossorigin=anonymous><link rel=stylesheet href=https://www.pseudoyu.com/css/den.css><link rel=stylesheet href=https://www.pseudoyu.com/css/custom.css><meta property="og:title" content="PostgreSQL 基础与实践"><meta property="og:description" content="《后来的我们 - 五月天》 前言 最近想着把工作中常用到的技术点与工具做一些整理总结，一方面梳理一下这些知识点，加深使用记忆，也可以作为之后使用的查"><meta property="og:type" content="article"><meta property="og:url" content="https://www.pseudoyu.com/en/2022/09/05/database_postgres_basic/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-05T23:30:46+08:00"><meta property="article:modified_time" content="2022-09-05T23:30:46+08:00"><meta itemprop=name content="PostgreSQL 基础与实践"><meta itemprop=description content="《后来的我们 - 五月天》 前言 最近想着把工作中常用到的技术点与工具做一些整理总结，一方面梳理一下这些知识点，加深使用记忆，也可以作为之后使用的查"><meta itemprop=datePublished content="2022-09-05T23:30:46+08:00"><meta itemprop=dateModified content="2022-09-05T23:30:46+08:00"><meta itemprop=wordCount content="4229"><meta itemprop=keywords content="database,postgres,programming,work practice series,work,practice,backend,"><meta name=twitter:card content="summary"><meta name=twitter:title content="PostgreSQL 基础与实践"><meta name=twitter:description content="《后来的我们 - 五月天》 前言 最近想着把工作中常用到的技术点与工具做一些整理总结，一方面梳理一下这些知识点，加深使用记忆，也可以作为之后使用的查"></head><body><div class=header-container style=background:linear-gradient(rgba(0,0,0,.2),rgba(0,0,0,.2)),url(https://www.pseudoyu.com/images/background.webp);background-position:50%;background-size:cover><div class=container><nav class="header-nav navbar navbar-expand-md navbar-dark light-dark"><div class="header-logo navbar-brand"><a class=float-left href=https://www.pseudoyu.com/en/><img class="mr20 header-logo-image" src=https://www.pseudoyu.com/images/fly.png alt=logo>
Pseudoyu</a></div><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="nav-menu collapse navbar-collapse" id=navbarNav><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/en/category/ideas/>Idea</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/en/category/tools/>Tool</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/en/category/develop/>Develop</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/en/links/>Links</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/en/about/>About</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/en/search/>Search</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/zh/><i class="fas fa-globe"></i> 中文</a></li></ul></div></nav></div><div class="container header-wrapper"><div class=row><div class=col-lg-12><div class=header-content><h1 class=header-title>PostgreSQL 基础与实践</h1><p class=header-date>Author:
pseudoyu
| <span>4229 words, 9 minutes</span>
| <span class=remark42__counter data-url=https://www.pseudoyu.com/en/2022/09/05/database_postgres_basic/></span> comments
| 2022-09-05
| Category:
<a href=https://www.pseudoyu.com/en/category/develop/>Develop</a></p><div class=header-underline></div><div class=clearfix></div><p class="float-right header-tags"><i class="fas fa-tags" aria-hidden=true></i>
<a href=https://www.pseudoyu.com/en/tag/backend/>backend</a>,
<a href=https://www.pseudoyu.com/en/tag/database/>database</a>,
<a href=https://www.pseudoyu.com/en/tag/postgres/>postgres</a>,
<a href=https://www.pseudoyu.com/en/tag/practice/>practice</a>,
<a href=https://www.pseudoyu.com/en/tag/programming/>programming</a>,
<a href=https://www.pseudoyu.com/en/tag/work/>work</a>,
<a href=https://www.pseudoyu.com/en/tag/work-practice-series/>work practice series</a></p><div class=clearfix></div><p class="float-right translations"><i class="fas fa-language" aria-hidden=true></i>
Translations:
<a href=https://www.pseudoyu.com/zh/2022/09/05/database_postgres_basic/>ZH</a></p></div></div></div></div></div><main><div class="container content"><articl data-pagefind-body><figure><audio controls preload=metadata><source src=/audios/here_after_us.mp3 type=audio/mpeg></audio><i><figcaption>《后来的我们 - 五月天》</figcaption></i></figure><h2 id=前言>前言</h2><p>最近想着把工作中常用到的技术点与工具做一些整理总结，一方面梳理一下这些知识点，加深使用记忆，也可以作为之后使用的查阅。</p><p>目前主要计划了数据库相关、CI/CD 相关（GitHub Actions + GitLab CI）、容器相关（Docker + k8s）、运维相关（Ansible 等）这几个核心介绍，以及一些像是语言特性、Git 实用技巧、Shell 脚本等技巧总结。因为有很多内容工作中只是接触到，自己做了一些拓展学习，所以不一定完全符合企业具体实践（大多为自己的经验与理解），希望能有所帮助。</p><p>本篇是数据库系列的 PostgreSQL 部分，关于 MySQL 之前已经梳理过，可以进行查阅 —— 『<a href=https://www.pseudoyu.com/en/2021/03/29/database_mysql_basic/>MySQL 基础知识与相关操作</a>』。</p><h2 id=数据与数据库概述>数据与数据库概述</h2><h3 id=数据>数据</h3><p>首先，数据其实本质上是一种事实或者观察到的结果，是对客观事务的逻辑上的归纳总结，是信息的一种表现形式和载体。人们从很早的时候就开始管理数据（即使还没有这个概念），最初是由人工管理，而后来渐渐有了文件系统（就像图书馆一样，分门别类地管理不同信息），而随着计算机技术的发展，最后形成了用数据库进行管理的这种较为便捷高效的模式。</p><h3 id=数据库>数据库</h3><p>数据库是按照一定的数据结构来组织、存储和管理数据的一个仓库，主要特征为</p><ul><li>结构化</li><li>可共享</li><li>冗余度小</li><li>独立性高</li><li>易于拓展</li></ul><p>很好理解的是，按照不同关系/结构组织起来的数据具备不同的特征，同时也适用于不同的应用场景，目前主要分为层次数据库、网状数据库和关系数据库三种，而我们要着重介绍的 Postgres 就是关系数据库。</p><h3 id=数据库管理系统dbms>数据库管理系统(DBMS)</h3><p>数据库管理系统(DBMS)是对数据库进行各种操作的一个系统，一具有建立和维护数据库、对数据的存储进行组织管理、对数据库进行控制、定义数据、操纵数据以及管理数据之间的通信等核心功能，不同的数据库管理系统对数据库和数据的处理方式不同，数据呈现方式也不同，也往往需要根据数据规模、业务需求等场景选择合适的数据库管理系统，如在海量数据和高并发数据读写的情况下，关系性数据库的性能会下降得很厉害。</p><h2 id=关系性数据库rdbms>关系性数据库(RDBMS)</h2><h3 id=主要特征>主要特征</h3><p>关系性数据库主要以数据表的形式呈现，每一行为一条记录，每一列则为记录名称所对应的数据域(Field)。许多行列组成一张单表，而若干单表则组成数据库。用户/系统通过 SQL(结构化查询语言对数据库进行查询。</p><p>有些关系型数据库的操作具有事务性，即 ACID 规则</p><ul><li>原子性(Atomicity)</li><li>一致性(Consistency)</li><li>隔离性(Isolation)</li><li>持久性(Durability)</li></ul><p>原子性是指一系列事务操作要么都完成，要么都失败，不存在完成了一部分这样的情况，例如银行转账这样的场景里，转账行为发生后，发送方余额减少，而如果数据库出现了操作错误，接收方余额未增加，则会造成严重的问题。</p><p>一致性是指在事务执行完成后，整个数据库的数据是一致的，不应存在数据库内同一数据不同步的情况。</p><p>隔离性则是指不同的事务之间应该独立进行运行、互不干扰的，当然，这样会牺牲一定的效率，但对数据的准确性等提供了较好保障。</p><p>持久性则是指当一个事务执行完成后，它对数据库进行的更改、对系统产生的影响是永久的。</p><h3 id=数据完整性>数据完整性</h3><p>数据完整性是数据库很重要的一个要求和属性，是指存储在数据库中的数据应该保持一致性和可靠性，主要分为以下四种</p><ul><li>实体完整性</li><li>域完整性</li><li>参照完整性</li><li>用户定义完整性</li></ul><p>实体完整性要求每张数据表都有一个唯一的标识符，每张表中的主键字段不能为空且不能重复，这主要是指表中的数据都可以被唯一区分。</p><p>域完整性则是通过对表中列做一些额外限制，如限制数据类型、检查约束、设置默认值、是否允许空值以及值域范围等。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--- 在创建表时对字段进行唯一性的约束
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=n>auto_increment</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>30</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id_number</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>18</span><span class=p>)</span><span class=w> </span><span class=k>UNIQUE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>参照完整性是指数据库不允许引用不存在的实体，数据库的表与其他表之间往往存在一些关联，可以通过外键约束来保障其完整性。</p><p>而用户自定义完整性则是根据具体应用场景和涉及到数据来对数据进行一些语义方面的限制，如余额不能为负数等，一般用设定规则、存储过程和触发器等来进行约束和限制。</p><h3 id=主流-rdbms>主流 RDBMS</h3><p>目前主流的关系型数据库有以下几种</p><ul><li>SQL Server</li><li>Sybase</li><li>DB2</li><li>Oracle</li><li>MySQL</li><li>PostgreSQL</li></ul><p>企业和个人用得比较多的是 Oracle、MySQL、PostgreSQL 几种，接下来也会以 PostgreSQL 为例进行详细的操作讲解。</p><h2 id=postgresql>PostgreSQL</h2><h3 id=安装与配置>安装与配置</h3><p>PostgreSQL 是一种现代化的开源对象关系性数据库管理系统。</p><p>作为个人用户学习使用，可以直接下载软件安装包使用本地搭建环境，可以根据不同的系统选择不同的版本，也具备较便捷的图形界面供大家进行服务的开启、关闭、重启以及进行相关的配置等。本文以 macOS 系统下的 <code>PostgreSQL 14</code> 为例，在<a href=https://postgresapp.com>官网</a>安装及进行基本设置后，就可以对本机 PostgreSQL 服务进行管理，版本可能会略有差别，但核心功能差别不大。</p><h4 id=图形界面>图形界面</h4><p>打开 PostgreSQL.app 应用，可以看到如下界面：</p><p><img src=https://image.pseudoyu.com/images/mac_postgres_interface.png alt=mac_postgres_interface></p><p>在这个管理界面可以很方便地进行 PostgreSQL 服务的开启与关闭，点击对应的数据库也可以进入命令行操作界面。</p><h4 id=命令行界面>命令行界面</h4><p>首先我们讲 <code>psql</code> 的路径加入环境变量以便后续使用，我使用的是 <code>zsh</code>，所以在 <code>~/.zshrc</code> 文件中添加如下内容：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># postgres</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span><span class=si>${</span><span class=nv>PATH</span><span class=si>}</span>:/Applications/Postgres.app/Contents/Versions/14/bin
</span></span></code></pre></div><p>之后在终端中输入 <code>psql</code>，就可以访问 PostgreSQL 的命令行界面了。可以使用如下命令查看 psql 的命令列表：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>psql --help
</span></span></code></pre></div><h3 id=连接-postgresql>连接 PostgreSQL</h3><p>我们可以通过以下命令连接数据库：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 连接数据库</span>
</span></span><span class=line><span class=cl>psql -h &lt;host&gt; -p &lt;port&gt; -U &lt;username&gt; &lt;database-name&gt;
</span></span></code></pre></div><p>当然，我们也可以通过一些第三方工具来更方便地连接数据库使用，我当前使用的 <a href=http://tableplus.com>TablePlus</a> 就支持 PostgreSQL 数据库，推荐。</p><h3 id=命令行交互>命令行交互</h3><p>PostgreSQL 提供了强大的命令行交互功能，我们可以使用 <code>\</code> + 关键词来进行操作。我们可以通过查阅文档或 <code>\?</code> 与 <code>help</code> 命令来查看命令详情与帮助信息。其他常用命令如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 查看帮助</span>
</span></span><span class=line><span class=cl><span class=nb>help</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看 psql 命令详情</span>
</span></span><span class=line><span class=cl><span class=se>\?</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看数据库（全部）</span>
</span></span><span class=line><span class=cl><span class=se>\l</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看数据库（指定）</span>
</span></span><span class=line><span class=cl><span class=se>\l</span> &lt;database-name&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 连接数据库</span>
</span></span><span class=line><span class=cl><span class=se>\c</span> &lt;database-name&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看方法</span>
</span></span><span class=line><span class=cl><span class=se>\d</span>f
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看表（全部）</span>
</span></span><span class=line><span class=cl><span class=se>\d</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看表（只看表）</span>
</span></span><span class=line><span class=cl><span class=se>\d</span>t
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看表（指定）</span>
</span></span><span class=line><span class=cl><span class=se>\d</span> &lt;table-name&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 执行 sql 命令</span>
</span></span><span class=line><span class=cl><span class=se>\i</span> &lt;filepath&gt;/&lt;filename&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 打开拓展视图</span>
</span></span><span class=line><span class=cl><span class=se>\x</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 导出至 CSV</span>
</span></span><span class=line><span class=cl><span class=se>\c</span>opy <span class=o>(</span>SELECT * FROM person LEFT JOIN car ON person.car_id <span class=o>=</span> car.id<span class=o>)</span> TO <span class=s1>&#39;path/to/output.csv&#39;</span> DELIMITER <span class=s1>&#39;,&#39;</span> CSV HEADER<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 退出</span>
</span></span><span class=line><span class=cl><span class=se>\q</span>
</span></span></code></pre></div><h3 id=核心语法>核心语法</h3><p>经过了本地 PostgreSQL 配置与连接后，我们就可以对数据库进行一些操作了，SQL 语言主要分为以下四类</p><ul><li>DDL 数据定义语言（Data Definition Language）</li><li>DML 数据操纵语言（Data Manipulation Language）</li><li>DQL 数据查询语言（Data Query Language）</li><li>DCL 数据控制语言（Data Control Language）</li></ul><h4 id=ddl-操作>DDL 操作</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--- 创建数据库
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=o>&lt;</span><span class=k>database</span><span class=o>-</span><span class=n>name</span><span class=o>&gt;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--- 删除数据库
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>DROP</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=o>&lt;</span><span class=k>database</span><span class=o>-</span><span class=n>name</span><span class=o>&gt;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 进入某个数据库</span>
</span></span><span class=line><span class=cl><span class=se>\c</span> &lt;database-name&gt;<span class=p>;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--- 创建表（添加约束）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=n>BIGSERIAL</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>first_name</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>last_name</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>gender</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>date_of_birth</span><span class=w> </span><span class=nb>DATE</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>country_of_birth</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>50</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>email</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>150</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--- 修改表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>ADD</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--- 删除字段
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>DROP</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=n>email</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--- 删除全表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>DROP</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>person</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h4 id=dml-操作>DML 操作</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--- 插入数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>first_name</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>last_name</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>gender</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>date_of_birth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;Yu&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;ZHANG&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;MALE&#39;</span><span class=p>,</span><span class=w> </span><span class=nb>DATE</span><span class=w> </span><span class=s1>&#39;1997-06-06&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--- 修改数据内容
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>UPDATE</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>email</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;ommar@gmail.com&#39;</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>20</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--- 删除数据内容
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>DELETE</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>可以使用 <code>ON CONFLICT</code> 关键字来处理冲突：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--- 当发生冲突时不进行操作
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>first_name</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>last_name</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>gender</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>date_of_birth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;Yu&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;ZHANG&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;MALE&#39;</span><span class=p>,</span><span class=w> </span><span class=nb>DATE</span><span class=w> </span><span class=s1>&#39;1997-06-06&#39;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>CONFLICT</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=k>DO</span><span class=w> </span><span class=k>NOTHING</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--- 当发生冲突时更新指定字段
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>first_name</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>last_name</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>gender</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>date_of_birth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;Yu&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;ZHANG&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;MALE&#39;</span><span class=p>,</span><span class=w> </span><span class=nb>DATE</span><span class=w> </span><span class=s1>&#39;1997-06-06&#39;</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>CONFLICT</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=k>DO</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>email</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>EXCLUDED</span><span class=p>.</span><span class=n>email</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h4 id=dql-操作>DQL 操作</h4><p>可以通过 <code>SELECT</code> 命令来对表进行查询，最常用的查看全表命令为</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--- 查看表的全部数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--- 查询数据（特定字段）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>first_name</span><span class=p>,</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>可以通过 <code>WHERE</code> 关键字来进行条件查询、以及多个条件的组合查询：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--- 查询数据（条件筛查，WHERE | AND | OR | 比较 &gt; | &gt;= | &lt; | &lt;= | = | &lt;&gt;）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>gender</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;MALE&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=p>(</span><span class=n>country_of_birth</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Poland&#39;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>country_of_birth</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;China&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p><code>IN</code>、<code>BETWEEN</code>、<code>LIKE</code> 和 <code>ILIKE</code> 也是一些可以很灵活用于查询的关键字。</p><p><code>IN</code> 可以帮助我们过滤某个字段的多个值。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--- 查询数据（使用 IN 关键词查询）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>country_of_birth</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;China&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Brazil&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;France&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p><code>BETWEEN</code> 可以帮助我们过滤某个字段的一个范围。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--- 查询数据（使用 BETWEEN 关键词查询）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>date_of_birth</span><span class=w> </span><span class=k>BETWEEN</span><span class=w> </span><span class=nb>DATE</span><span class=w> </span><span class=s1>&#39;2021-10-10&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=s1>&#39;2022-08-31&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p><code>LIKE</code> 可以帮助我们进行一些包含关系的模糊搜索，<code>%</code> 可以匹配任一个字符，<code>_</code> 可以匹配单个字符。而 <code>ILIKE</code> 则是不区分大小写的 <code>LIKE</code>。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--- 查询数据（使用 LIKE/ILIKE 关键词查询，_ | %）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>email</span><span class=w> </span><span class=k>LIKE</span><span class=w> </span><span class=s1>&#39;%@bloomberg.%&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>email</span><span class=w> </span><span class=k>LIKE</span><span class=w> </span><span class=s1>&#39;________@google.%&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>country_of_birth</span><span class=w> </span><span class=k>ILIKE</span><span class=w> </span><span class=s1>&#39;p%&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>实际应用中，往往数据表的数据量非常庞大，会对数据根据相应条件进行分组，这就要用到 <code>GROUP BY</code> 关键字，以及 <code>HAVING</code> 用于进一步筛选条件。<code>GROUP BY</code> 需要配合聚合函数进行使用。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--- 查询数据（使用 GROUP BY 关键词分组查询，使用 HAVING 关键词添加条件，使用 AS 对结果别名）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>country_of_birth</span><span class=p>,</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>Amount</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>country_of_birth</span><span class=w> </span><span class=k>HAVING</span><span class=w> </span><span class=n>Amount</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>5</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>country_of_birth</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>有时候我们只需要返回唯一值，而需要去掉重复数据，则可以使用 <code>DISTINCT</code> 关键字</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--- 查询数据（去重）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=k>DISTINCT</span><span class=w> </span><span class=n>country_of_birth</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>在实际应用中，还很有可能会需要对某些商品交易量进行排名、对一些数值进行排列或博客文章中按照时间线后进行顺序显示等，这就需要用到 <code>ORDER BY</code> 这一关键字，它默认为 <code>ASC</code> 升序排列，可以通过手动设置 <code>DESC</code> 来实现降序。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--- 查询数据（排序 ASC | DESC）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>country_of_birth</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>同时，有的数据库数据量非常大，一次返回所有的数据比较消耗资源，因此也可以使用 <code>LIMIT</code> 关键字来约束返回的记录数，同时可以使用 <code>OFFSET</code> 指定偏移量。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--- 查询数据（指定数量与偏移量）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>OFFSET</span><span class=w> </span><span class=mi>5</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>OFFSET</span><span class=w> </span><span class=mi>5</span><span class=w> </span><span class=k>FETCH</span><span class=w> </span><span class=k>FIRST</span><span class=w> </span><span class=mi>5</span><span class=w> </span><span class=k>ROW</span><span class=w> </span><span class=k>ONLY</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=核心概念>核心概念</h3><h4 id=primary-key-主键>PRIMARY KEY 主键</h4><p>主键在数据表中的唯一身份记录，用以下命令创建与修改：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--- 添加主键
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=n>BIGSERIAL</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--- 修改主键
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>ADD</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>其中主键通常会使用 <code>SERIAL/BIGSERIAL</code> 递增 <code>INT</code> 值，也可以使用 <code>UUID</code> 作为主键。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=n>UUID</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h4 id=foreign-key-外键>FOREIGN KEY 外键</h4><p>外键是一种特殊的主键，它是另一个表的主键，用以下命令创建与修改：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--- 添加外键
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=n>BIGSERIAL</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>car_id</span><span class=w> </span><span class=nb>BIGINT</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=n>car</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>UNIQUE</span><span class=p>(</span><span class=n>car_id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--- 修改外键
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>car</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=n>BIGSERIAL</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><h4 id=join-联表查询>JOIN 联表查询</h4><p>联表查询是指在查询时，将多个表中的数据进行连接，以便查询出更多的信息。在 SQL 中，我们可以使用 <code>JOIN</code> 关键字来实现联表查询，使用 <code>LEFT JOIN</code> 关键字来实现左联表查询，使用 <code>RIGHT JOIN</code> 关键字来实现右联表查询。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--- JOIN 联表查询
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>JOIN</span><span class=w> </span><span class=n>car</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>person</span><span class=p>.</span><span class=n>car_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>car</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--- LEFT JOIN 左联表查询
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>car</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>person</span><span class=p>.</span><span class=n>car_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>car</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span></code></pre></div><p>可以通过 <code>USING</code> 关键字来简化 <code>ON</code> 关键字的使用。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>car</span><span class=w> </span><span class=k>USING</span><span class=w> </span><span class=p>(</span><span class=n>car_id</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h4 id=约束>约束</h4><p>CONSTRAINT 约束是用来限制数据表中的数据的，我们可以通过以下命令来添加约束：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>ADD</span><span class=w> </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=n>gender_constraint</span><span class=w> </span><span class=k>CHECK</span><span class=w> </span><span class=p>(</span><span class=n>gender</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Female&#39;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>gender</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Male&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>例如通过添加 <code>UNIQUE</code> 来显示唯一：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=n>BIGSERIAL</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>email</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>150</span><span class=p>)</span><span class=w> </span><span class=k>UNIQUE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>person</span><span class=w> </span><span class=k>ADD</span><span class=w> </span><span class=n>CONTRAINT</span><span class=w> </span><span class=n>unique_email_address</span><span class=w> </span><span class=k>UNIQUE</span><span class=w> </span><span class=p>(</span><span class=n>email</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h3 id=常用技巧>常用技巧</h3><h4 id=聚合函数>聚合函数</h4><p>内置了很多聚合函数，例如 <code>COUNT</code>、<code>SUM</code>、<code>AVG</code>、<code>MIN</code>、<code>MAX</code> 等，用于对数据进行聚合计算。</p><h4 id=coalesce>COALESCE</h4><p>在查询数据时我们可以使用 <code>COALESCE</code> 填充默认值：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--- 使用 COALESCE 填充默认值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>COALESCE</span><span class=p>(</span><span class=n>email</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Email Not Provided&#39;</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h4 id=nullif>NULLIF</h4><p>使用 <code>NULLIF</code> 关键字，当第二个参数与第一个相同时返回 <code>NULL</code>，否则返回第一个参数，用于防止一些被除数为 <code>0</code> 的报错等。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>COALESCE</span><span class=p>(</span><span class=mi>10</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=k>NULLIF</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>),</span><span class=w> </span><span class=mi>0</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h4 id=时间>时间</h4><p>时间的显示格式如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>NOW</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>NOW</span><span class=p>()::</span><span class=nb>DATE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>NOW</span><span class=p>()::</span><span class=n>TIME</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>我们可以对时间进行运算：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>NOW</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nb>INTERVAL</span><span class=w> </span><span class=s1>&#39;1 YEAR&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>NOW</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>INTERVAL</span><span class=w> </span><span class=s1>&#39;10 MONTHS&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=p>(</span><span class=n>NOW</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nb>INTERVAL</span><span class=w> </span><span class=s1>&#39;3 DAYS&#39;</span><span class=p>)::</span><span class=nb>DATE</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>可以通过 <code>EXTRACT</code> 来获取时间的某个部分：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>EXTRACT</span><span class=p>(</span><span class=k>YEAR</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>NOW</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>EXTRACT</span><span class=p>(</span><span class=k>MONTH</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>NOW</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>EXTRACT</span><span class=p>(</span><span class=k>DAY</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>NOW</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>EXTRACT</span><span class=p>(</span><span class=n>DOW</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>NOW</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>EXTRACT</span><span class=p>(</span><span class=n>CENTURY</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>NOW</span><span class=p>());</span><span class=w>
</span></span></span></code></pre></div><p>可以通过 <code>AGE</code> 关键字来计算年龄差值：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>first_name</span><span class=p>,</span><span class=w> </span><span class=n>last_name</span><span class=p>,</span><span class=w> </span><span class=n>AGE</span><span class=p>(</span><span class=n>NOW</span><span class=p>(),</span><span class=w> </span><span class=n>date_of_birth</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>person</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=拓展支持>拓展支持</h3><p>PostgreSQL 提供了许多拓展，以实现更丰富的功能。</p><h4 id=安装拓展>安装拓展</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=n>EXTENSION</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=s2>&#34;uuid-ossp&#34;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h4 id=查看拓展方法>查看拓展方法</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>df
</span></span></code></pre></div><h4 id=使用拓展方法>使用拓展方法</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>uuid_generate_v4</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><h2 id=总结>总结</h2><p>以上就是我对 PostgreSQL 的基础知识与实用操作的讲解，希望对你有所帮助。</p><h2 id=参考资料>参考资料</h2><blockquote><ol><li><a href=http://www.postgresql.org>PostgreSQL 官网</a></li><li><a href=https://postgresapp.com>Postgres.app 官网</a></li><li><a href=https://tableplus.com>TablePlus 官网</a></li></ol></blockquote></articl><h2>Related Posts</h2><dl class=row></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl><dt class=col-md-3>2022-09-07</dt><dd class=col-md-9><a href=/en/2022/09/07/container_docker_basic/>Docker 基础与实践</a></dd></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl><dt class=col-md-3>2022-05-21</dt><dd class=col-md-9><a href=/en/2022/05/21/writing_a_simple_in_memory_key_value_database_in_go/>[译] 用 Go 编写一个简单的内存键值数据库</a></dd></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl><dt class=col-md-3>2021-03-29</dt><dd class=col-md-9><a href=/en/2021/03/29/database_mysql_basic/>MySQL 基础与实践</a></dd></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl><div class=author-card><div class=underline></div><div class=author-box><div class=author-image><a href=https://www.pseudoyu.com><img src=/images/author.webp alt=pseudoyu></a></div><div class=author-content><p class=author-title>Author</p><p class=author-name>pseudoyu</p><p class=author-desc>Backend & Smart Contract Developer, MSc Graduate in ECIC(Electronic Commerce and Internet Computing) @ The University of Hong Kong (HKU). Love to learn and build things. <a href=https://github.com/pseudoyu>Follow me on GitHub</a></p></div></div></div><div align=center><div class=comment-underline></div></div><br><div class=comments><div class=title><span>Comments</span>
<span class=counter><span class=remark42__counter data-url=https://www.pseudoyu.com/en/2022/09/05/database_postgres_basic/></span></span></div><div id=remark42></div></div><script>var remark_config={host:"https://comments.pseudoyu.com",site_id:"pseudoyu.com",components:["embed","counter"],max_shown_comments:20,simple_view:!0,theme:"light"}</script><script>(function(){const t=window.REMARK42;if(t)t.destroy(),t.createInstance(remark_config);else for(const t of remark_config.components){var n=document,e=n.createElement("script");e.src=`${remark_config.host}/web/${t}.mjs`,e.type="module",e.defer=!0,e.setAttribute("data-no-instant",""),n.head.appendChild(e)}})()</script></div></main><div class="footer gradient-2"><div class="container footer-container"><div class=row><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>Sitemap</div><ul class=list-unstyled><li><a href=https://www.pseudoyu.com/en/tags/>Tags</a></li><li><a href=https://www.pseudoyu.com/en/categories/>Categories</a></li><li><a rel=alternate type=application/rss+xml href=https://www.pseudoyu.com/en/index.xml><i class="fas fa-rss-square"></i> RSS Feed</a></li></ul></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>Social</div><ul class=list-unstyled><li><a href=https://t.me/pseudoyulife rel=noopener target=_blank>Telegram</a></li><li><a href=https://twitter.com/pseudo_yu rel=noopener target=_blank>Twitter</a></li><li><a href=https://www.instagram.com/pseudo.yu/ rel=noopener target=_blank>Instagram</a></li><li><a href=https://space.bilibili.com/5374948/ rel=noopener target=_blank>BiliBili</a></li></ul></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>Links</div><ul class=list-unstyled><li><a href=https://github.com/pseudoyu rel=noopener target=_blank>Yu's GitHub</a></li><li><a href=https://uptime.pseudoyu.com/status/services rel=noopener target=_blank>Yu's Services</a></li><li><a href=https://www.m1sty.com/ rel=noopener target=_blank>M1sty's Blog</a></li></ul></div><div class="col-xs-12 col-sm-3 col-md-3 col-lg-3"><p class="pull-right text-right"><small><em><a href="https://stats.pseudoyu.com?access-token=2m1u5i2k413q0733h2a3332w3m1t6r634g1m6n" rel=noopener target=_blank>Yu's blog analytics</a></em></small><br><small><em>Powered by <a href=https://gohugo.io rel=noopener target=_blank>Hugo</a> - <a href=https://github.com/shaform/hugo-theme-den rel=noopener target=_blank>den</a></em></small><br><small><em><a href=https://www.hku.hk rel=noopener target=_blank>The University of Hong Kong</a> - <a href=https://www.cs.hku.hk rel=noopener target=_blank>CS</a></em></small><br><small>&copy;
Yu Zhang
2020 -
2024</small></p></div><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" id=scroll-top class=scroll-top accesskey=g><span class=arrow-icon></span></a>
<script>var mybutton=document.getElementById("scroll-top");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></div></div></div><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script></body></html>