<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta name=generator content="Hugo 0.105.0"><meta charset=utf-8><title>Solidity Smart Contract Development - Using the Hardhat Framework · Pseudoyu</title><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><script data-goatcounter=https://stats.pseudoyu.com/count async src=//stats.pseudoyu.com/count.js></script><meta name=description content="&amp;#39;Here After Us - Mayday&amp;#39; Preface After the previous articles on smart contract basics, Web3.py, and ethers.js, we have mastered the fundamental knowledge of interacting directly with blockchain networks through programs. For those unfamiliar, you can review:
Solidity Smart Contract Development - Basics Solidity Smart Contract Development - Mastering Web3.py Solidity Smart Contract Development - Mastering ethers.js However, in real complex business scenarios, we often use some further encapsulated frameworks, such as HardHat, Brownie, Truffle, etc."><meta name=keywords content="hugo,blockchain,programming"><link rel=canonical href=https://www.pseudoyu.com/en/2022/06/09/learn_solidity_from_scratch_hardhat/><link rel=alternate href=https://www.pseudoyu.com/zh/2022/06/09/learn_solidity_from_scratch_hardhat/ hreflang=zh><link rel=alternate href=https://www.pseudoyu.com/de/2022/06/09/learn_solidity_from_scratch_hardhat/ hreflang=de><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css integrity=sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css integrity=sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ crossorigin=anonymous><link rel=stylesheet href=https://www.pseudoyu.com/css/den.css><link rel=stylesheet href=https://www.pseudoyu.com/css/custom.css><meta property="og:title" content="Solidity Smart Contract Development - Using the Hardhat Framework"><meta property="og:description" content="'Here After Us - Mayday' Preface After the previous articles on smart contract basics, Web3.py, and ethers.js, we have mastered the fundamental knowledge of interacting directly with blockchain networks through programs. For those unfamiliar, you can review:
Solidity Smart Contract Development - Basics Solidity Smart Contract Development - Mastering Web3.py Solidity Smart Contract Development - Mastering ethers.js However, in real complex business scenarios, we often use some further encapsulated frameworks, such as HardHat, Brownie, Truffle, etc."><meta property="og:type" content="article"><meta property="og:url" content="https://www.pseudoyu.com/en/2022/06/09/learn_solidity_from_scratch_hardhat/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-09T14:38:10+08:00"><meta property="article:modified_time" content="2022-06-09T14:38:10+08:00"><meta itemprop=name content="Solidity Smart Contract Development - Using the Hardhat Framework"><meta itemprop=description content="'Here After Us - Mayday' Preface After the previous articles on smart contract basics, Web3.py, and ethers.js, we have mastered the fundamental knowledge of interacting directly with blockchain networks through programs. For those unfamiliar, you can review:
Solidity Smart Contract Development - Basics Solidity Smart Contract Development - Mastering Web3.py Solidity Smart Contract Development - Mastering ethers.js However, in real complex business scenarios, we often use some further encapsulated frameworks, such as HardHat, Brownie, Truffle, etc."><meta itemprop=datePublished content="2022-06-09T14:38:10+08:00"><meta itemprop=dateModified content="2022-06-09T14:38:10+08:00"><meta itemprop=wordCount content="2145"><meta itemprop=keywords content="blockchain,solidity,ethereum,web3,smart contract,javascript,ethers.js,hardhat,yarn,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Solidity Smart Contract Development - Using the Hardhat Framework"><meta name=twitter:description content="'Here After Us - Mayday' Preface After the previous articles on smart contract basics, Web3.py, and ethers.js, we have mastered the fundamental knowledge of interacting directly with blockchain networks through programs. For those unfamiliar, you can review:
Solidity Smart Contract Development - Basics Solidity Smart Contract Development - Mastering Web3.py Solidity Smart Contract Development - Mastering ethers.js However, in real complex business scenarios, we often use some further encapsulated frameworks, such as HardHat, Brownie, Truffle, etc."></head><body><div class=header-container style=background:linear-gradient(rgba(0,0,0,.2),rgba(0,0,0,.2)),url(https://www.pseudoyu.com/images/background.png);background-position:50%;background-size:cover><div class=container><nav class="header-nav navbar navbar-expand-md navbar-dark light-dark"><div class="header-logo navbar-brand"><a class=float-left href=https://www.pseudoyu.com/en/><img class="mr20 header-logo-image" src=https://www.pseudoyu.com/images/icon.png alt=logo>
Pseudoyu</a></div><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="nav-menu collapse navbar-collapse" id=navbarNav><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/en/category/ideas/>Idea</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/en/category/tools/>Tool</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/en/category/develop/>Develop</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/en/links/>Links</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/en/about/>About</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/en/search/>Search</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/zh/><i class="fas fa-globe"></i> 简</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/de/><i class="fas fa-globe"></i> DE</a></li></ul></div></nav></div><div class="container header-wrapper"><div class=row><div class=col-lg-12><div class=header-content><h1 class=header-title>Solidity Smart Contract Development - Using the Hardhat Framework</h1><p class=header-date>Author:
pseudoyu
| <span>2145 words, 11 minutes</span>
| <span class=remark42__counter data-url=https://www.pseudoyu.com/en/2022/06/09/learn_solidity_from_scratch_hardhat/></span> comments
| 2022-06-09
| Category:
<a href=https://www.pseudoyu.com/en/category/develop/>Develop</a></p><div class=header-underline></div><div class=clearfix></div><p class="float-right header-tags"><i class="fas fa-tags" aria-hidden=true></i>
<a href=https://www.pseudoyu.com/en/tag/blockchain/>blockchain</a>,
<a href=https://www.pseudoyu.com/en/tag/ethereum/>ethereum</a>,
<a href=https://www.pseudoyu.com/en/tag/ethers.js/>ethers.js</a>,
<a href=https://www.pseudoyu.com/en/tag/hardhat/>hardhat</a>,
<a href=https://www.pseudoyu.com/en/tag/javascript/>javascript</a>,
<a href=https://www.pseudoyu.com/en/tag/smart-contract/>smart contract</a>,
<a href=https://www.pseudoyu.com/en/tag/solidity/>solidity</a>,
<a href=https://www.pseudoyu.com/en/tag/web3/>web3</a>,
<a href=https://www.pseudoyu.com/en/tag/yarn/>yarn</a></p><div class=clearfix></div><p class="float-right translations"><i class="fas fa-language" aria-hidden=true></i>
Translations:
<a href=https://www.pseudoyu.com/zh/2022/06/09/learn_solidity_from_scratch_hardhat/>ZH</a>, <a href=https://www.pseudoyu.com/de/2022/06/09/learn_solidity_from_scratch_hardhat/>DE</a></p></div></div></div></div></div><main><div class="container content"><articl data-pagefind-body><figure><audio controls preload=metadata><source src=/audios/here_after_us.mp3 type=audio/mpeg></audio><i><figcaption>'Here After Us - Mayday'</figcaption></i></figure><h2 id=preface>Preface</h2><p>After the previous articles on smart contract basics, Web3.py, and ethers.js, we have mastered the fundamental knowledge of interacting directly with blockchain networks through programs. For those unfamiliar, you can review:</p><ul><li><a href=https://www.pseudoyu.com/en/2022/05/25/learn_solidity_from_scratch_basic/>Solidity Smart Contract Development - Basics</a></li><li><a href=https://www.pseudoyu.com/en/2022/05/30/learn_solidity_from_scratch_web3py/>Solidity Smart Contract Development - Mastering Web3.py</a></li><li><a href=https://www.pseudoyu.com/en/2022/06/08/learn_solidity_from_scratch_ethersjs/>Solidity Smart Contract Development - Mastering ethers.js</a></li></ul><p>However, in real complex business scenarios, we often use some further encapsulated frameworks, such as HardHat, Brownie, Truffle, etc. HardHat is the most widely used and has the most powerful plugin expansion. This series will focus on the use and best practices of the Hardhat framework starting from this article, and this article will complete its installation, configuration, and use through a simple example.</p><p>This article is a summary of learning from <a href=https://twitter.com/PatrickAlphaC>Patrick Collins</a>&rsquo;s <a href="https://www.youtube.com/watch?v=gyMwXuJrbJQ">&ldquo;Learn Blockchain, Solidity, and Full Stack Web3 Development with JavaScript&rdquo;</a> tutorial. It is strongly recommended to watch the original tutorial video for more details.</p><p>You can click <a href=https://github.com/pseudoyu/learn-solidity/tree/master/hardhat_simple_storage>here</a> to access the code repository for this test demo.</p><h2 id=introduction-to-hardhat>Introduction to Hardhat</h2><p><img src=https://image.pseudoyu.com/images/hardhat_homepage.png alt=hardhat_homepage></p><p>Hardhat is a JavaScript-based smart contract development environment that can be used to flexibly compile, deploy, test, and debug EVM-based smart contracts. It provides a series of toolchains to integrate code with external tools and offers a rich plugin ecosystem to improve development efficiency. In addition, it also provides a local Hardhat network node that simulates Ethereum, offering powerful local debugging capabilities.</p><p>Its GitHub address is <a href=https://github.com/NomicFoundation/hardhat>NomicFoundation/hardhat</a>, and you can visit its <a href=https://hardhat.org/getting-started>official documentation</a> to learn more.</p><h2 id=using-hardhat>Using Hardhat</h2><h3 id=initializing-the-project>Initializing the Project</h3><p>To build a Hardhat project from scratch, we need to pre-install <code>node.js</code> and <code>yarn</code> environments. This part can be installed according to the official instructions based on your system environment.</p><p>First, we need to initialize the project and install the <code>hardhat</code> dependency package.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yarn init
</span></span><span class=line><span class=cl>yarn add --dev hardhat
</span></span></code></pre></div><p><img src=https://image.pseudoyu.com/images/yarn_add.png alt=yarn_add></p><h3 id=initializing-hardhat>Initializing Hardhat</h3><p>Then we need to run <code>yarn hardhat</code> to initialize through interactive commands. Configure according to project needs. For our test demo, we choose the default values.</p><p><img src=https://image.pseudoyu.com/images/hardhat_project_init.png alt=hardhat_project_init></p><h3 id=optimizing-code-formatting>Optimizing Code Formatting</h3><h4 id=vs-code-configuration>VS Code Configuration</h4><p>I develop code locally using VS Code. You can format code by installing the <code>Solidity + Hardhat</code> and <code>Prettier</code> plugins. You can open VS Code settings and add the following formatting configuration in <code>settings.json</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;[solidity]&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;editor.defaultFormatter&#34;</span><span class=p>:</span> <span class=s2>&#34;NomicFoundation.hardhat-solidity&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;[javascript]&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;editor.defaultFormatter&#34;</span><span class=p>:</span> <span class=s2>&#34;esbenp.prettier-vscode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=project-configuration>Project Configuration</h4><p>To unify the code formatting styles of developers using various projects, we can also configure <code>prettier</code> and <code>prettier-plugin-solidity</code> plugin support for the project:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yarn add --dev prettier prettier-plugin-solidity
</span></span></code></pre></div><p><img src=https://image.pseudoyu.com/images/yarn_add_prettier_plugin.png alt=yarn_add_prettier_plugin></p><p>After adding dependencies, you can add <code>.prettierrc</code> and <code>.prettierignore</code> configuration files in the project directory to unify formatting:</p><p>My <code>.prettierrc</code> configuration is:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;tabWidth&#34;</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;useTabs&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;semi&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;singleQuote&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>My <code>.prettierignore</code> configuration is:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>node_modules
</span></span><span class=line><span class=cl>package.json
</span></span><span class=line><span class=cl>img
</span></span><span class=line><span class=cl>artifacts
</span></span><span class=line><span class=cl>cache
</span></span><span class=line><span class=cl>coverage
</span></span><span class=line><span class=cl>.env
</span></span><span class=line><span class=cl>.*
</span></span><span class=line><span class=cl>README.md
</span></span><span class=line><span class=cl>coverage.json
</span></span></code></pre></div><h3 id=compiling-contracts>Compiling Contracts</h3><p>There&rsquo;s no need to customize the <code>compile</code> command like in <code>ethers.js</code>. HardHat provides a built-in <code>compile</code> command. You can place contracts in the <code>contracts</code> directory and then compile them using the <code>yarn hardhat compile</code> command:</p><p><img src=https://image.pseudoyu.com/images/hardhat_compile_contract.png alt=hardhat_compile_contract></p><h3 id=adding-dotenv-support>Adding <code>dotenv</code> Support</h3><p>Before we start writing deployment scripts, let&rsquo;s configure the <code>dotenv</code> plugin. This way, we can use <code>dotenv</code> to get environment variables. During development, we will deal with a lot of private information, such as private keys, etc. We would like to store them in a <code>.env</code> file or set them directly in the terminal, such as our <code>RINKEBY_PRIVATE_TOKEN</code>. This way, we can use <code>process.env.RINKEBY_PRIVATE_TOKEN</code> to get the value in the deployment script without explicitly writing it in the code, reducing the risk of privacy leakage.</p><h4 id=installing-dotenv>Installing <code>dotenv</code></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yarn add --dev dotenv
</span></span></code></pre></div><p><img src=https://image.pseudoyu.com/images/yarn_add_dotenv.png alt=yarn_add_dotenv></p><h4 id=setting-environment-variables>Setting Environment Variables</h4><p>In the <code>.env</code> file, we can set environment variables, such as:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>RINKEBY_RPC_URL=url
</span></span><span class=line><span class=cl>RINKEBY_PRIVATE_KEY=0xkey
</span></span><span class=line><span class=cl>ETHERSCAN_API_KEY=key
</span></span><span class=line><span class=cl>COINMARKETCAP_API_KEY=key
</span></span></code></pre></div><p>We can then read environment variables in <code>hardhat.config.js</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;dotenv&#34;</span><span class=p>).</span><span class=nx>config</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>RINKEBY_RPC_URL</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>RINKEBY_RPC_URL</span> <span class=o>||</span> <span class=s2>&#34;https://eth-rinkeby/example&#34;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>RINKEBY_PRIVATE_KEY</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>RINKEBY_PRIVATE_KEY</span> <span class=o>||</span> <span class=s2>&#34;0xkey&#34;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>ETHERSCAN_API_KEY</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>ETHERSCAN_API_KEY</span> <span class=o>||</span> <span class=s2>&#34;key&#34;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>COINMARKETCAP_API_KEY</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>COINMARKETCAP_API_KEY</span> <span class=o>||</span> <span class=s2>&#34;key&#34;</span>
</span></span></code></pre></div><h3 id=configuring-network-environment>Configuring Network Environment</h3><p>Often, our contracts need to run on different blockchain networks, such as local testing, development, and production environments. Hardhat also provides a convenient way to configure network environments.</p><h4 id=starting-the-network>Starting the Network</h4><p>We can directly run a script to start a network that comes with Hardhat, but this network only exists during script execution. To start a locally sustainable network, you need to run the <code>yarn hardhat node</code> command:</p><p><img src=https://image.pseudoyu.com/images/hardhat_localhost_node.png alt=hardhat_localhost_node></p><p>After execution, test networks and test accounts are generated for subsequent development and debugging.</p><p>We can also generate our own test network nodes through platforms like Alchemy or Infura, and record their <code>RPC_URL</code> for program connection use.</p><h4 id=defining-networks>Defining Networks</h4><p>After preparing the network environment, we can define networks in the project configuration <code>hardhat.config.js</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>RINKEBY_RPC_URL</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>RINKEBY_RPC_URL</span> <span class=o>||</span> <span class=s2>&#34;https://eth-rinkeby/example&#34;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>RINKEBY_PRIVATE_KEY</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>RINKEBY_PRIVATE_KEY</span> <span class=o>||</span> <span class=s2>&#34;0xkey&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>defaultNetwork</span><span class=o>:</span> <span class=s2>&#34;hardhat&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>networks</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>locakhost</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>url</span><span class=o>:</span> <span class=s2>&#34;http://localhost:8545&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>chainId</span><span class=o>:</span> <span class=mi>31337</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>rinkeby</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>url</span><span class=o>:</span> <span class=nx>RINKEBY_RPC_URL</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>accounts</span><span class=o>:</span> <span class=p>[</span><span class=nx>RINKEBY_PRIVATE_KEY</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nx>chainId</span><span class=o>:</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...,
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h3 id=scripts>Scripts</h3><p>In a Hardhat project, we can implement functions such as deployment by writing scripts in the <code>scripts</code> directory and execute scripts through convenient commands.</p><h4 id=writing-deployment-scripts>Writing Deployment Scripts</h4><p>Next, let&rsquo;s start writing the <code>deploy.js</code> script.</p><p>First, we need to import necessary packages from <code>hardhat</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>ethers</span><span class=p>,</span> <span class=nx>run</span><span class=p>,</span> <span class=nx>network</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;hardhat&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>Then write the <code>main</code> method, which includes our core deployment logic:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>SimpleStorageFactory</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>ethers</span><span class=p>.</span><span class=nx>getContractFactory</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;SimpleStorage&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Deploying SimpleStorage Contract...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>simpleStorage</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>SimpleStorageFactory</span><span class=p>.</span><span class=nx>deploy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>simpleStorage</span><span class=p>.</span><span class=nx>deployed</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;SimpleStorage Contract deployed at:&#34;</span><span class=p>,</span> <span class=nx>simpleStorage</span><span class=p>.</span><span class=nx>address</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Get current value
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>currentValue</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>simpleStorage</span><span class=p>.</span><span class=nx>retrieve</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Current value:&#34;</span><span class=p>,</span> <span class=nx>currentValue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Set value
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>transactionResponse</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>simpleStorage</span><span class=p>.</span><span class=nx>store</span><span class=p>(</span><span class=mi>7</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>transactionResponse</span><span class=p>.</span><span class=nx>wait</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Get updated value
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>updatedValue</span> <span class=o>=</span> <span class=kr>await</span> <span class=kr>await</span> <span class=nx>simpleStorage</span><span class=p>.</span><span class=nx>retrieve</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Updated value:&#34;</span><span class=p>,</span> <span class=nx>updatedValue</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Finally, run our <code>main</code> method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=k>catch</span><span class=p>((</span><span class=nx>error</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span></code></pre></div><h4 id=running-scripts>Running Scripts</h4><p>After completing the script writing, you can run the script using the <code>run</code> command provided by Hardhat.</p><p>If no network parameter is added, the <code>hardhat</code> network is used by default. You can specify the network using the <code>--network</code> parameter:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yarn hardhat run scripts/deploy.js --network rinkeby
</span></span></code></pre></div><p><img src=https://image.pseudoyu.com/images/hardhat_deploy_rinkeby.png alt=hardhat_deploy_rinkeby></p><h3 id=adding-etherscan-contract-verification-support>Adding Etherscan Contract Verification Support</h3><p>After deploying the contract to the Rinkeby test network, you can view the contract address on Etherscan and verify it. We can do this through the website, but Hardhat provides plugin support, making it more convenient to perform verification operations.</p><h4 id=installing-hardhat-etherscan-plugin>Installing hardhat-etherscan Plugin</h4><p>We install the plugin using the <code>yarn add --dev @nomiclabs/hardhat-etherscan</code> command.</p><p><img src=https://image.pseudoyu.com/images/yarn_add_etherscan_verify_support.png alt=yarn_add_etherscan_verify_support></p><h4 id=enabling-etherscan-contract-verification-support>Enabling Etherscan Contract Verification Support</h4><p>After installation, we need to configure in <code>hardhat.config.js</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@nomiclabs/hardhat-etherscan&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...,
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>etherscan</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>apiKey</span><span class=o>:</span> <span class=nx>ETHERSCAN_API_KEY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...,
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h4 id=defining-verify-method>Defining Verify Method</h4><p>Next, we need to add a <code>verify</code> method in the deployment script <code>deploy.js</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>ethers</span><span class=p>,</span> <span class=nx>run</span><span class=p>,</span> <span class=nx>network</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;hardhat&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>verify</span><span class=p>(</span><span class=nx>contractAddress</span><span class=p>,</span> <span class=nx>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Verifying SimpleStorage Contract...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>run</span><span class=p>(</span><span class=s2>&#34;verify:verify&#34;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>address</span><span class=o>:</span> <span class=nx>contractAddress</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>constructorArguements</span><span class=o>:</span> <span class=nx>args</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>message</span><span class=p>.</span><span class=nx>toLowerCase</span><span class=p>().</span><span class=nx>includes</span><span class=p>(</span><span class=s2>&#34;already verified!&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Already Verified!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>In this method, we call the <code>run</code> method from the <code>hardhat</code> package, pass a <code>verify</code> command, and pass a parameter <code>{ address: contractAddress, constructorArguements: args }</code>. Since our contract may have already been verified on Etherscan, we do a <code>try...catch...</code> error handling. If it&rsquo;s already verified, it will throw an error and output a prompt message without affecting our deployment process.</p><h4 id=setting-post-deployment-call>Setting Post-Deployment Call</h4><p>After defining our <code>verify</code> method, we can call it in the deployment script:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>network</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>chainId</span> <span class=o>===</span> <span class=mi>4</span> <span class=o>&amp;&amp;</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>ETHERSCAN_API_KEY</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>simpleStorage</span><span class=p>.</span><span class=nx>deployTransaction</span><span class=p>.</span><span class=nx>wait</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>verify</span><span class=p>(</span><span class=nx>simpleStorage</span><span class=p>.</span><span class=nx>address</span><span class=p>,</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p>Here we made two special treatments.</p><p>First, we only need to verify the contract on the <code>rinkeby</code> network, not on local or other network environments. Therefore, we judge <code>network.config.chainId</code>. If it&rsquo;s <code>4</code>, we perform the verification operation; otherwise, we don&rsquo;t. In addition, we only perform the verification operation when there is an <code>ETHERSCAN_API_KEY</code> environment variable.</p><p>Also, Etherscan may need some time after deployment to get the contract address, so we configured <code>.wait(6)</code> to wait for 6 blocks before verification.</p><p>The execution effect is as follows:</p><p><img src=https://image.pseudoyu.com/images/hardhat_verify_contract_etherscan.png alt=hardhat_verify_contract_etherscan></p><p><img src=https://image.pseudoyu.com/images/verified_contract_on_etherscan.png alt=verified_contract_on_etherscan></p><p>After verification through Etherscan, we can directly view the contract source code and interact with it.</p><p><img src=https://image.pseudoyu.com/images/interact_with_contract_on_etherscan.png alt=interact_with_contract_on_etherscan></p><h3 id=contract-testing>Contract Testing</h3><p>For smart contracts, most operations need to be deployed on-chain, interact with assets, consume gas, and once there are security vulnerabilities, it will cause serious consequences. Therefore, we need to conduct detailed tests on smart contracts.</p><p>Hardhat provides comprehensive testing and debugging tools. We can write test scripts in the <code>tests</code> directory and run tests using the <code>yarn hardhat test</code> command.</p><h4 id=writing-test-scripts>Writing Test Scripts</h4><p>Let&rsquo;s write a <code>test-deploy.js</code> test program for our deployment script. First, we need to import the necessary packages:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>assert</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;chai&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>ethers</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;hardhat&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>Then write the test logic:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s2>&#34;SimpleStorage&#34;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>simpleStorageFactory</span><span class=p>,</span> <span class=nx>simpleStorage</span>
</span></span><span class=line><span class=cl>    <span class=nx>beforeEach</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>simpleStorageFactory</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>ethers</span><span class=p>.</span><span class=nx>getContractFactory</span><span class=p>(</span><span class=s2>&#34;SimpleStorage&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>simpleStorage</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>simpleStorageFactory</span><span class=p>.</span><span class=nx>deploy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>it</span><span class=p>(</span><span class=s2>&#34;Should start with a favorite number of 0&#34;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>currentValue</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>simpleStorage</span><span class=p>.</span><span class=nx>retrieve</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>expectedValue</span> <span class=o>=</span> <span class=s2>&#34;0&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>assert</span><span class=p>.</span><span class=nx>equal</span><span class=p>(</span><span class=nx>currentValue</span><span class=p>.</span><span class=nx>toString</span><span class=p>(),</span> <span class=nx>expectedValue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1>// expect(currentValue.toString()).to.equal(expectedValue)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>it</span><span class=p>(</span><span class=s2>&#34;Should update when we call store&#34;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>expectedValue</span> <span class=o>=</span> <span class=s2>&#34;7&#34;</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>transactionRespense</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>simpleStorage</span><span class=p>.</span><span class=nx>store</span><span class=p>(</span><span class=nx>expectedValue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>transactionRespense</span><span class=p>.</span><span class=nx>wait</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>currentValue</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>simpleStorage</span><span class=p>.</span><span class=nx>retrieve</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>assert</span><span class=p>.</span><span class=nx>equal</span><span class=p>(</span><span class=nx>currentValue</span><span class=p>.</span><span class=nx>toString</span><span class=p>(),</span> <span class=nx>expectedValue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1>// expect(currentValue.toString()).to.equal(expectedValue)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>})</span>
</span></span></code></pre></div><p>In Hardhat&rsquo;s test script, we use <code>describe</code> to wrap the test class and use <code>it</code> to wrap the test method. We need to ensure that the contract is deployed before testing, so we use the <code>beforeEach</code> method to call <code>simpleStorageFactory.deploy()</code> before each test method is executed, and assign the returned <code>simpleStorage</code> object to the <code>simpleStorage</code> variable.</p><p>We use <code>assert.equal(currentValue.toString(), expectedValue)</code> to compare the execution result with the expected result. It can be replaced with <code>expect(currentValue.toString()).to.equal(expectedValue)</code>, which has the same effect.</p><p>In addition, we can use <code>it.only()</code> to specify that only one of the test methods is executed.</p><h4 id=running-test-scripts>Running Test Scripts</h4><p>We run the test with <code>yarn hardhat test</code> and can specify test methods with <code>yarn hardhat test --grep store</code>.</p><p><img src=https://image.pseudoyu.com/images/hardhat_run_tests.png alt=hardhat_run_tests></p><h3 id=adding-gas-reporter-support>Adding <code>gas-reporter</code> Support</h3><p>As mentioned above, gas is a resource we need to pay special attention to during development, especially expensive on the Ethereum mainnet. Therefore, we need to check gas consumption during testing. HardHat also has a <code>gas-reporter</code> plugin that can conveniently output gas consumption information.</p><h4 id=installing-gas-reporter-plugin>Installing <code>gas-reporter</code> Plugin</h4><p>We install the plugin using the <code>yarn add --dev hardhat-gas-reporter</code> command:</p><p><img src=https://image.pseudoyu.com/images/yarn_add_gas_reporter.png alt=yarn_add_gas_reporter></p><h4 id=enabling-gas-reporter-support>Enabling <code>gas-reporter</code> Support</h4><p>We enable the plugin by adding <code>gasReporter: true</code> and additional configuration items in <code>hardhat.config.js</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;hardhat-gas-reporter&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>COINMARKETCAP_API_KEY</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>COINMARKETCAP_API_KEY</span> <span class=o>||</span> <span class=s2>&#34;key&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...,
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>gasReporter</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>enabled</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>outputFile</span><span class=o>:</span> <span class=s2>&#34;gas-reporter.txt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>noColors</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>currency</span><span class=o>:</span> <span class=s2>&#34;USD&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>coinmarketcap</span><span class=o>:</span> <span class=nx>COINMARKETCAP_API_KEY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>token</span><span class=o>:</span> <span class=s2>&#34;MATIC&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>We can specify output file, whether to enable colors, specify currency, specify token name, and specify CoinMarketCap API key to further control output according to the project.</p><p>According to the above configuration, running <code>yarn hardhat test</code> outputs the following effect:</p><p><img src=https://image.pseudoyu.com/images/hardhat_add_gas_reporter_support_and_export.png alt=hardhat_add_gas_reporter_support_and_export></p><h3 id=adding-solidity-coverage-support>Adding <code>solidity-coverage</code> Support</h3><p>Contract testing is crucial for ensuring business logic correctness and security prevention. Therefore, we need to conduct coverage testing on contracts. HardHat also has a <code>solidity-coverage</code> plugin that can conveniently output coverage information.</p><h4 id=installing-solidity-coverage-plugin>Installing <code>solidity-coverage</code> Plugin</h4><p>We install the plugin using the <code>yarn add --dev solidity-coverage</code> command:</p><p><img src=https://image.pseudoyu.com/images/yarn_add_coverage_support.png alt=yarn_add_coverage_support></p><h4 id=enabling-solidity-coverage-support>Enabling <code>solidity-coverage</code> Support</h4><p>We only need to import the package in <code>hardhat.config.js</code> to add coverage test support:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;solidity-coverage&#34;</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=running-coverage-test>Running Coverage Test</h4><p>Run coverage test with <code>yarn hardhat coverage</code>:</p><p><img src=https://image.pseudoyu.com/images/hardhat_coverage.png alt=hardhat_coverage></p><h3 id=task>Task</h3><p>Above, we have used some basic functions and scripts of the <code>hardhat</code> library. In addition, we can also customize some tasks for development and debugging.</p><h4 id=writing-tasks>Writing Tasks</h4><p>In Hardhat, we define tasks in the <code>tasks</code> directory. We will write a <code>block-number.js</code> task to get the block height:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>task</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;hardhat/config&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>task</span><span class=p>(</span><span class=s2>&#34;block-number&#34;</span><span class=p>,</span> <span class=s2>&#34;Prints the current block number&#34;</span><span class=p>).</span><span class=nx>setAction</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=p>(</span><span class=nx>taskArgs</span><span class=p>,</span> <span class=nx>hre</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>blockNumber</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>hre</span><span class=p>.</span><span class=nx>ethers</span><span class=p>.</span><span class=nx>provider</span><span class=p>.</span><span class=nx>getBlockNumber</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Current Block Number: </span><span class=si>${</span><span class=nx>blockNumber</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p>Tasks are created using the <code>task()</code> method and the execution function is set using the <code>setAction()</code> method. Here, <code>taskArgs</code> is an object containing all parameters, and <code>hre</code> is a <code>HardhatRuntimeEnvironment</code> object that can be used to get other resources.</p><h4 id=running-tasks>Running Tasks</h4><p>After definition, our newly defined <code>block-number</code> task will appear in the <code>AVAILABLE TASKS</code> of the project command. You can run the task using the <code>yarn hardhat block-number</code> command. Similarly, we can specify a specific network to run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yarn hardhat block-number --network rinkeby
</span></span></code></pre></div><p><img src=https://image.pseudoyu.com/images/hardhat_run_tasks.png alt=hardhat_run_tasks></p><h3 id=hardhat-console>Hardhat Console</h3><p>Finally, in addition to interacting with the chain/contract through code, we can also debug projects, view chain status, contract input and output, etc. through the <code>Hardhat Console</code>. We can open the Hardhat Console and interact using the <code>yarn hardhat console</code> command.</p><p><img src=https://image.pseudoyu.com/images/hardhat_console.png alt=hardhat_console></p><h2 id=conclusion>Conclusion</h2><p>The above is my basic configuration and use of the Hardhat framework. It is a very powerful development framework, and I will continue to delve into more of its features and usage techniques in the future. If you&rsquo;re interested, you can continue to follow. I hope this is helpful to everyone.</p><h2 id=references>References</h2><blockquote><ol><li><a href="https://www.youtube.com/watch?v=gyMwXuJrbJQ">Learn Blockchain, Solidity, and Full Stack Web3 Development with JavaScript</a></li><li><a href=https://github.com/NomicFoundation/hardhat>NomicFoundation/hardhat</a></li><li><a href=https://hardhat.org/getting-started>Hardhat Official Documentation</a></li><li><a href=https://www.pseudoyu.com/en/2022/05/25/learn_solidity_from_scratch_basic/>Solidity Smart Contract Development - Basics</a></li><li><a href=https://www.pseudoyu.com/en/2022/05/30/learn_solidity_from_scratch_web3py/>Solidity Smart Contract Development - Mastering Web3.py</a></li><li><a href=https://www.pseudoyu.com/en/2022/06/08/learn_solidity_from_scratch_ethersjs/>Solidity Smart Contract Development - Mastering ethers.js</a></li></ol></blockquote></articl><h2>Related Posts</h2><dl class=row></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl><dt class=col-md-3>2023-09-13</dt><dd class=col-md-9><a href=/en/2023/09/13/weekly_review_20230913/>Weekly Review #46 - Farewell to Long Hair, Weekly Review's Original Intention, and Contract Development</a></dd></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl><dt class=col-md-3>2023-04-30</dt><dd class=col-md-9><a href=/en/2023/04/30/weekly_review_20230430/>Weekly Review #38 - Foundry Contract Testing, Logseq Task Management, and Surge Ponte Remote Development</a></dd></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl><dt class=col-md-3>2022-07-01</dt><dd class=col-md-9><a href=/en/2022/07/01/two_phase_commit_contract_practice_in_solidity/>Implementing Two-Phase Commit in Solidity Smart Contracts Using State Locks</a></dd></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl><dt class=col-md-3>2022-06-08</dt><dd class=col-md-9><a href=/en/2022/06/08/learn_solidity_from_scratch_ethersjs/>Solidity Smart Contract Development - Mastering ethers.js</a></dd></dl></dl></dl></dl></dl></dl></dl><dt class=col-md-3>2022-05-30</dt><dd class=col-md-9><a href=/en/2022/05/30/learn_solidity_from_scratch_web3py/>Solidity Smart Contract Development - Mastering Web3.py</a></dd></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl><div class=author-card><div class=underline></div><div class=author-box><div class=author-image><a href=https://www.pseudoyu.com><img src=/images/author.webp alt=pseudoyu></a></div><div class=author-content><p class=author-title>Author</p><p class=author-name>pseudoyu</p><p class=author-desc>Backend & Smart Contract Developer, MSc Graduate in ECIC(Electronic Commerce and Internet Computing) @ The University of Hong Kong (HKU). Love to learn and build things. <a href=https://github.com/pseudoyu>Follow me on GitHub</a></p></div></div></div><div align=center><div class=comment-underline></div></div><br><div class=comments><div class=title><span>Comments</span>
<span class=counter><span class=remark42__counter data-url=https://www.pseudoyu.com/en/2022/06/09/learn_solidity_from_scratch_hardhat/></span></span></div><div id=remark42></div></div><script>var remark_config={host:"https://comments.pseudoyu.com",site_id:"pseudoyu.com",components:["embed","counter"],max_shown_comments:20,simple_view:!0,theme:"light"}</script><script>(function(){const t=window.REMARK42;if(t)t.destroy(),t.createInstance(remark_config);else for(const t of remark_config.components){var n=document,e=n.createElement("script");e.src=`${remark_config.host}/web/${t}.mjs`,e.type="module",e.defer=!0,e.setAttribute("data-no-instant",""),n.head.appendChild(e)}})()</script></div></main><div class="footer gradient-2"><div class="container footer-container"><div class=row><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>Sitemap</div><ul class=list-unstyled><li><a href=https://www.pseudoyu.com/en/tags/>Tags</a></li><li><a href=https://www.pseudoyu.com/en/categories/>Categories</a></li><li><a rel=alternate type=application/rss+xml href=https://www.pseudoyu.com/en/index.xml><i class="fas fa-rss-square"></i> RSS Feed</a></li></ul></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>Social</div><ul class=list-unstyled><li><a href=https://t.me/pseudoyulife rel=noopener target=_blank>Telegram</a></li><li><a href=https://twitter.com/pseudo_yu rel=noopener target=_blank>Twitter</a></li><li><a href=https://www.instagram.com/pseudo.yu/ rel=noopener target=_blank>Instagram</a></li><li><a href=https://space.bilibili.com/5374948/ rel=noopener target=_blank>BiliBili</a></li></ul></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>Links</div><ul class=list-unstyled><li><a href=https://github.com/pseudoyu rel=noopener target=_blank>Yu's GitHub</a></li></ul></div><div class="col-xs-12 col-sm-3 col-md-3 col-lg-3"><p class="pull-right text-right"><small><em><a href="https://stats.pseudoyu.com?access-token=2m1u5i2k413q0733h2a3332w3m1t6r634g1m6n" rel=noopener target=_blank>Yu's blog analytics</a></em></small><br><small><em>Powered by <a href=https://gohugo.io rel=noopener target=_blank>Hugo</a> - <a href=https://github.com/shaform/hugo-theme-den rel=noopener target=_blank>den</a></em></small><br><small><em><a href=https://www.hku.hk rel=noopener target=_blank>The University of Hong Kong</a> - <a href=https://www.cs.hku.hk rel=noopener target=_blank>CS</a></em></small><br><small>&copy;
Yu Zhang
2020 -
2024</small></p></div><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" id=scroll-top class=scroll-top accesskey=g><span class=arrow-icon></span></a>
<script>var mybutton=document.getElementById("scroll-top");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></div></div></div><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script></body></html>