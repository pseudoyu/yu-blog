<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta name=generator content="Hugo 0.105.0"><meta charset=utf-8><title>Build Your Free Blog Comment System from Scratch (Remark42 + fly.io) · Pseudoyu</title><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><script data-goatcounter=https://stats.pseudoyu.com/count async src=//stats.pseudoyu.com/count.js></script><meta name=description content="Preface In the article &amp;ldquo;What Changed in My Blog in 2024&amp;rdquo;, I introduced the blog system I built using Serverless platforms and some open-source projects, and also started this series of tutorials to document the entire process of building and deploying.
This article is about the solution for the commenting system.
Evolution of Commenting Systems I often feel that comments are not just communication between readers and authors, but the content itself is also part of the article."><meta name=keywords content="hugo,blockchain,programming"><link rel=canonical href=https://www.pseudoyu.com/en/2024/07/22/free_commenting_system_using_remark42_and_flyio/><link rel=alternate href=https://www.pseudoyu.com/zh/2024/07/22/free_commenting_system_using_remark42_and_flyio/ hreflang=zh><link rel=alternate href=https://www.pseudoyu.com/de/2024/07/22/free_commenting_system_using_remark42_and_flyio/ hreflang=de><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css integrity=sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css integrity=sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ crossorigin=anonymous><link rel=stylesheet href=https://www.pseudoyu.com/css/den.css><link rel=stylesheet href=https://www.pseudoyu.com/css/custom.css><meta property="og:title" content="Build Your Free Blog Comment System from Scratch (Remark42 + fly.io)"><meta property="og:description" content="Preface In the article &ldquo;What Changed in My Blog in 2024&rdquo;, I introduced the blog system I built using Serverless platforms and some open-source projects, and also started this series of tutorials to document the entire process of building and deploying.
This article is about the solution for the commenting system.
Evolution of Commenting Systems I often feel that comments are not just communication between readers and authors, but the content itself is also part of the article."><meta property="og:type" content="article"><meta property="og:url" content="https://www.pseudoyu.com/en/2024/07/22/free_commenting_system_using_remark42_and_flyio/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-07-22T01:10:42+08:00"><meta property="article:modified_time" content="2024-07-22T01:10:42+08:00"><meta itemprop=name content="Build Your Free Blog Comment System from Scratch (Remark42 + fly.io)"><meta itemprop=description content="Preface In the article &ldquo;What Changed in My Blog in 2024&rdquo;, I introduced the blog system I built using Serverless platforms and some open-source projects, and also started this series of tutorials to document the entire process of building and deploying.
This article is about the solution for the commenting system.
Evolution of Commenting Systems I often feel that comments are not just communication between readers and authors, but the content itself is also part of the article."><meta itemprop=datePublished content="2024-07-22T01:10:42+08:00"><meta itemprop=dateModified content="2024-07-22T01:10:42+08:00"><meta itemprop=wordCount content="2489"><meta itemprop=keywords content="commenting-system,serverless,fly.io,blog,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Build Your Free Blog Comment System from Scratch (Remark42 + fly.io)"><meta name=twitter:description content="Preface In the article &ldquo;What Changed in My Blog in 2024&rdquo;, I introduced the blog system I built using Serverless platforms and some open-source projects, and also started this series of tutorials to document the entire process of building and deploying.
This article is about the solution for the commenting system.
Evolution of Commenting Systems I often feel that comments are not just communication between readers and authors, but the content itself is also part of the article."></head><body><div class=header-container style=background:linear-gradient(rgba(0,0,0,.2),rgba(0,0,0,.2)),url(https://www.pseudoyu.com/images/background.png);background-position:50%;background-size:cover><div class=container><nav class="header-nav navbar navbar-expand-md navbar-dark light-dark"><div class="header-logo navbar-brand"><a class=float-left href=https://www.pseudoyu.com/en/><img class="mr20 header-logo-image" src=https://www.pseudoyu.com/images/icon.png alt=logo>
Pseudoyu</a></div><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="nav-menu collapse navbar-collapse" id=navbarNav><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/en/category/ideas/>Idea</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/en/category/tools/>Tool</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/en/category/develop/>Develop</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/en/links/>Links</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/en/about/>About</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/en/search/>Search</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/zh/><i class="fas fa-globe"></i> 简</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/de/><i class="fas fa-globe"></i> DE</a></li></ul></div></nav></div><div class="container header-wrapper"><div class=row><div class=col-lg-12><div class=header-content><h1 class=header-title>Build Your Free Blog Comment System from Scratch (Remark42 + fly.io)</h1><p class=header-date>Author:
pseudoyu
| <span>2489 words, 12 minutes</span>
| <span class=remark42__counter data-url=https://www.pseudoyu.com/en/2024/07/22/free_commenting_system_using_remark42_and_flyio/></span> comments
| 2024-07-22
| Category:
<a href=https://www.pseudoyu.com/en/category/tools/>Tools</a></p><div class=header-underline></div><div class=clearfix></div><p class="float-right header-tags"><i class="fas fa-tags" aria-hidden=true></i>
<a href=https://www.pseudoyu.com/en/tag/blog/>blog</a>,
<a href=https://www.pseudoyu.com/en/tag/commenting-system/>commenting-system</a>,
<a href=https://www.pseudoyu.com/en/tag/fly.io/>fly.io</a>,
<a href=https://www.pseudoyu.com/en/tag/serverless/>serverless</a></p><div class=clearfix></div><p class="float-right translations"><i class="fas fa-language" aria-hidden=true></i>
Translations:
<a href=https://www.pseudoyu.com/zh/2024/07/22/free_commenting_system_using_remark42_and_flyio/>ZH</a>, <a href=https://www.pseudoyu.com/de/2024/07/22/free_commenting_system_using_remark42_and_flyio/>DE</a></p></div></div></div></div></div><main><div class="container content"><articl data-pagefind-body><h2 id=preface>Preface</h2><p>In the article &ldquo;What Changed in My Blog in 2024&rdquo;, I introduced the blog system I built using Serverless platforms and some open-source projects, and also started this series of tutorials to document the entire process of building and deploying.</p><p>This article is about the solution for the commenting system.</p><h2 id=evolution-of-commenting-systems>Evolution of Commenting Systems</h2><p><img src=https://image.pseudoyu.com/images/remark42_comments.png alt=remark42_comments></p><p>I often feel that comments are not just communication between readers and authors, but the content itself is also part of the article. Sometimes the thoughts and discussions in comments can be more valuable than the article itself. Therefore, I have always placed great importance on the commenting system. I am unwilling to trust some third-party hosted services, do not want any censorship, and want the style to be as minimalist as possible and consistent with my blog style.</p><p>During the development of my blog, the commenting system solution has gone through several iterations. Regarding the types and choices of commenting systems, I very much like the developer <a href=https://reorx.com/>reorx</a>&rsquo;s detailed introduction in &ldquo;Changing Blog Commenting Systems&rdquo;. I won&rsquo;t elaborate further here; this article focuses more on personal experience and detailed setup process.</p><h3 id=disqus>Disqus</h3><p>The first blog commenting system I used was the notorious Disqus, a cumbersome and user privacy-collecting well-known commenting system. Because it loads slowly and the free version often comes with some ads, it was really unbearable. Plus, at that time, there were basically no comments, so there was no migration burden. I abandoned it after using it for a short time.</p><h3 id=utterances>Utterances</h3><p>So I switched to another commenting system based on GitHub issues called utterances. It generates an issue for each article, and users comment on the issue by authorizing GitHub login. The advantage of this method is that it only needs to authorize an utterances-bot for management, without the need to deploy services and maintain databases by yourself. However, after using it for a while, I felt there were several shortcomings:</p><ul><li>It relies on the GitHub API for comment management. If the interface changes later or restrictions are placed on this type of commenting method using issues, it would be unstable.</li><li>Readers must authorize GitHub login, which is very inconvenient for non-technical people or readers using mobile devices.</li><li>It pollutes the Issues record of the GitHub repository and is also inconvenient for subsequent migration to other systems.</li></ul><h3 id=cusdis--supabase--vercel>Cusdis + Supabase + Vercel</h3><p>Cusdis is an open-source commenting system focusing on data privacy made by <a href=https://lutaonan.com/>Randy</a>. It&rsquo;s very lightweight, only about 5kb after gzipping. From the name, you can see it&rsquo;s hard to bear Disqus, so he made an alternative version. Therefore, it also supports importing historical data from Disqus, which is very thoughtful.</p><p>I&rsquo;ve been using it since mid-2021, exactly three years now. Except for the initial hassle with deployment platforms due to Heroku and Railway successively charging, it has been running steadily. However, I&rsquo;ve also encountered some issues in use:</p><ul><li>Probably due to some modifications made by WeChat&rsquo;s built-in browser, the comment component can&rsquo;t be seen when the blog is opened from WeChat chat/dialogue.</li><li>Although you can enter an email address, it doesn&rsquo;t support subscribing to comment replies.</li><li>The administrator needs to manually review comments, but the TG Bot for comment notifications often fails, causing missed comments.</li></ul><p>However, overall, it&rsquo;s still a highly recommended solution even today. It&rsquo;s lightweight, easy to self-deploy, and has a minimalist and good-looking style. For setup instructions, refer to &ldquo;Lightweight Open Source Free Blog Comment System Solution (Cusdis + Railway)&rdquo;.</p><p>Given that Railway has cancelled its Free Plan since August last year, if you still want to use it completely free, you can use Vercel/Netlify/Zeabur to deploy the main project for free, and deploy a free PostgreSQL database instance on <a href=https://supabase.com>Supabase</a>, passing the link as an environment variable to the Cusdis service. Other procedures are similar.</p><p>Also, because its core features haven&rsquo;t been updated for a long time, it seems a bit rudimentary compared to other more mature commenting systems. However, as I also adhere to the principle of &ldquo;good enough is good enough&rdquo;, I never had the idea of migrating/updating. I only participated in some development of the Cusdis V2 version for a while when I was learning front-end, but I didn&rsquo;t do it for long.</p><p>Due to the constant failure of Vercel deployment upgrades in April, which caused me to not receive comments for nearly a few weeks, plus I did have some functional requirements, so I made up my mind to migrate and explored new solutions.</p><h3 id=remark42--flyio>Remark42 + fly.io</h3><p>After researching around, I chose <a href=https://remark42.com/>Remark42</a> which <a href=https://reorx.com/>reorx</a> finally selected in the article &ldquo;Changing Blog Commenting Systems&rdquo;.</p><p>Just in terms of configuration options, it&rsquo;s much richer than Cusdis. Currently, I&rsquo;ve configured several common social account logins (GitHub, Twitter, Telegram, email), anonymous commenting is allowed, it supports email subscription for reply notifications, and I&rsquo;ve also set up TG bot notifications. It&rsquo;s deployed on <a href=https://fly.io>fly.io</a>, with go single binary + single file database, a very comfortable solution. For more detailed introduction and advantages of Remark42, you can refer to the article mentioned above.</p><p>Although Remark42 provides some migration solutions, it doesn&rsquo;t inherently support Cusdis which I was using. But since it&rsquo;s written in Golang, I added migration logic myself and seamlessly migrated the 438 comments data accumulated over these years.</p><h2 id=remark42--flyio-deployment-instructions>Remark42 + fly.io Deployment Instructions</h2><p>The Remark42 + fly.io solution only involves a single service, with the database using boltdb mounted in a volume, but all operations are within fly.io&rsquo;s Free Plan.</p><p>Below, I&rsquo;ll introduce how to build this free commenting system from scratch.</p><p>Remark42&rsquo;s code itself is open source - &ldquo;GitHub - umputun/remark42&rdquo;, and it provides an officially maintained image. The documentation is clear and easy to read, and you can configure it according to your actual needs.</p><h3 id=install-flyctl-command-line-tool>Install <code>flyctl</code> Command Line Tool</h3><p><a href=https://fly.io>fly.io</a> differs greatly from Railway, Zeabur, etc. that I used before in that most operations are based on command line and configuration files, rather than operating in a web management backend. So first, you need to install the <code>flyctl</code> command line tool according to the <a href=https://fly.io/docs/flyctl/install/>documentation</a>.</p><p>Taking macOS as an example, I use <code>brew</code> for installation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>brew install flyctl
</span></span></code></pre></div><h3 id=authorize-login>Authorize Login</h3><p>Open the terminal tool and use the following command for authorized login:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>flyctl auth login
</span></span></code></pre></div><p><img src=https://image.pseudoyu.com/images/fly_auth_login.png alt=fly_auth_login></p><p><img src=https://image.pseudoyu.com/images/fly_auth_web.png alt=fly_auth_web></p><p>Log in to your account or create a new account on the web end. After completion, click &ldquo;Continue as xxx&rdquo; to complete the authorization login of the <code>flyctl</code> command line.</p><h3 id=create-application-directory>Create Application Directory</h3><p><img src=https://image.pseudoyu.com/images/create_fly_config.png alt=create_fly_config></p><p>Since I usually manually manage configurations rather than using their official templates, I create a directory like <code>remark42-on-fly</code> and put all configuration files, environment variables, etc. in this path.</p><p>And use VS Code for editing (you can also use vim or other editors/IDEs).</p><h3 id=configuration-file>Configuration File</h3><p>fly.io mainly uses <code>.toml</code> format configuration files for service management. Here is the configuration file corresponding to the service I deployed:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=nx>app</span> <span class=p>=</span> <span class=s1>&#39;yu-remark42-01&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>primary_region</span> <span class=p>=</span> <span class=s1>&#39;hkg&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>build</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=nx>image</span> <span class=p>=</span> <span class=s1>&#39;umputun/remark42:latest&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[[</span><span class=nx>mounts</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>  <span class=nx>source</span> <span class=p>=</span> <span class=s1>&#39;remark42_data_01&#39;</span>
</span></span><span class=line><span class=cl>  <span class=nx>destination</span> <span class=p>=</span> <span class=s1>&#39;/srv/var&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>http_service</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=nx>internal_port</span> <span class=p>=</span> <span class=mi>8080</span>
</span></span><span class=line><span class=cl>  <span class=nx>force_https</span> <span class=p>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>  <span class=nx>auto_stop_machines</span> <span class=p>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>  <span class=nx>auto_start_machines</span> <span class=p>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>  <span class=nx>min_machines_running</span> <span class=p>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=nx>processes</span> <span class=p>=</span> <span class=p>[</span><span class=s1>&#39;app&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>env</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=nx>REMARK_URL</span> <span class=p>=</span> <span class=s1>&#39;https://yu-remark42-01.fly.dev/&#39;</span>
</span></span><span class=line><span class=cl>  <span class=nx>SECRET</span> <span class=p>=</span> <span class=s1>&#39;remark42-secret&#39;</span>
</span></span><span class=line><span class=cl>  <span class=nx>SITE</span><span class=p>=</span> <span class=s1>&#39;remark42-demo&#39;</span>
</span></span><span class=line><span class=cl>  <span class=nx>ADMIN_SHARED_ID</span><span class=p>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[[</span><span class=nx>vm</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>  <span class=nx>cpu_kind</span> <span class=p>=</span> <span class=s1>&#39;shared&#39;</span>
</span></span><span class=line><span class=cl>  <span class=nx>cpus</span> <span class=p>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=nx>memory_mb</span> <span class=p>=</span> <span class=mi>256</span>
</span></span></code></pre></div><p>Here&rsquo;s a detailed configuration explanation:</p><ul><li><code>app</code>: Application name, I used <code>yu-remark42-01</code> here, you can modify it according to your actual situation</li><li><code>primary_region</code>: Deployment region, you can choose the region you want to deploy from this <a href=https://fly.io/docs/reference/regions/#fly-io-regions>list</a>, I chose Hong Kong</li><li><code>[Build]</code>, this part is mainly about service image configuration<ul><li><code>image</code>: Service image, using the officially provided <code>umputun/remark42:latest</code>, you can specify the tag version if needed</li></ul></li><li><code>[[mounts]]</code>, this part is mainly about mounting data volume configuration, as Remark42 uses boltdb database, it needs persistent storage<ul><li><code>source</code>: Data volume name, I used <code>remark42_data_01</code> here</li><li><code>destination</code>: Mount directory, I mounted it to <code>/srv/var</code>, which is Remark42&rsquo;s default data storage directory</li></ul></li><li><code>[http_service]</code>, this part is mainly about service-related configuration<ul><li><code>internal_port</code>: Internal service port, using 8080</li><li><code>force_https</code>: Force the use of HTTPS</li><li><code>auto_stop_machines</code>: Set to <code>false</code></li><li><code>auto_start_machines</code>: Set to <code>true</code>, i.e., auto-start</li><li><code>min_machines_running</code>: Minimum number of running machines, set to 1</li><li><code>processes</code>: Service process, set to <code>app</code></li></ul></li><li><code>[env]</code>, configure environment variables<ul><li><code>REMARK_URL</code>: URL of Remark42 service, I used <code>https://yu-remark42-demo.fly.dev/</code> here, which is automatically generated by fly.io, it needs to be changed later if you have a custom domain</li><li><code>SITE</code>: Site name, I used <code>remark42-demo</code> here</li><li><code>SECRET</code>: Custom JWT Token, I used <code>remark42-secret</code> here</li><li><code>ADMIN_SHARED_ID</code>: Administrator ID, I used an empty string here, i.e., no administrator, can be supplemented later</li></ul></li><li><code>[[vm]]</code>, this part is mainly about machine-related configuration<ul><li><code>cpu_kind</code>: CPU type, set to <code>shared</code></li><li><code>cpus</code>: Number of CPUs, set to 1</li><li><code>memory_mb</code>: Memory, set to 256MB</li></ul></li></ul><h3 id=create-service>Create Service</h3><p>After completing and checking the configuration, run the following command to create the service:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>flyctl launch
</span></span></code></pre></div><p><img src=https://image.pseudoyu.com/images/fly_launch_remark42.png alt=fly_launch_remark42></p><h3 id=environment-variable-configuration>Environment Variable Configuration</h3><p>Currently, we have only deployed the service and have not set environment variables, so the service will have problems starting. Next, we set environment variables, put them in the <code>prod.env</code> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>AUTH_GITHUB_CID=&lt;your_github_cid&gt;
</span></span><span class=line><span class=cl>AUTH_GITHUB_CSEC=&lt;your_github_csec&gt;
</span></span><span class=line><span class=cl>AUTH_TWITTER_CID=&lt;your_twitter_cid&gt;
</span></span><span class=line><span class=cl>AUTH_TWITTER_CSEC=&lt;your_twitter_csec&gt;
</span></span><span class=line><span class=cl>AUTH_ANON=true
</span></span><span class=line><span class=cl>AUTH_TELEGRAM=true
</span></span><span class=line><span class=cl>TELEGRAM_TOKEN=&lt;your_telegram_token&gt;
</span></span><span class=line><span class=cl>NOTIFY_ADMINS=telegram
</span></span><span class=line><span class=cl>NOTIFY_TELEGRAM_CHAN=&lt;your_telegram_group&gt;
</span></span><span class=line><span class=cl>NOTIFY_USERS=email
</span></span><span class=line><span class=cl>AUTH_EMAIL_ENABLE=true
</span></span><span class=line><span class=cl>SMTP_HOST=smtp.gmail.com
</span></span><span class=line><span class=cl>SMTP_PORT=465
</span></span><span class=line><span class=cl>SMTP_TLS=true
</span></span><span class=line><span class=cl>SMTP_USERNAME=xxx@gmail.com
</span></span><span class=line><span class=cl>SMTP_PASSWORD=&lt;your_password&gt;
</span></span><span class=line><span class=cl>AUTH_EMAIL_FROM=xxx@gmail.com
</span></span><span class=line><span class=cl>NOTIFY_EMAIL_FROM=xxx@gmail.com
</span></span></code></pre></div><p>The environment variable part is relatively complex, refer to the <a href=https://remark42.com/docs/configuration/authorization/>documentation</a> for specific parameters.</p><h4 id=loginauthorization-configuration>Login/Authorization Configuration</h4><p>I configured anonymous commenting, GitHub, Twitter, and Telegram methods, you can configure other login methods according to your situation.</p><ul><li>Anonymous login<ul><li><code>AUTH_ANON</code>: Whether to allow anonymous comments, I chose to allow, i.e., users can comment without logging in</li></ul></li><li>GitHub login<ul><li><code>AUTH_GITHUB_CID</code> and <code>AUTH_GITHUB_CSEC</code>: Client ID and Client Secret of GitHub OAuth App</li></ul></li><li>Twitter login<ul><li><code>AUTH_TWITTER_CID</code> and <code>AUTH_TWITTER_CSEC</code>: Client ID and Client Secret of Twitter OAuth App</li></ul></li><li>Telegram login<ul><li><code>AUTH_TELEGRAM</code>: Whether to allow Telegram login</li><li><code>TELEGRAM_TOKEN</code>: Telegram Bot Token, created through <code>botfather</code></li></ul></li><li>Email login<ul><li><code>AUTH_EMAIL_ENABLE</code>: Whether to allow email login</li><li><code>AUTH_EMAIL_FROM</code>: Sending email for email login</li></ul></li></ul><h4 id=notification-configuration>Notification Configuration</h4><ul><li>Telegram notification for administrators, refer to <a href=https://remark42.com/docs/configuration/telegram/>this part of the documentation</a> for creating and configuring Telegram Bot<ul><li><code>NOTIFY_ADMINS</code>: Method of notifying administrators, choose telegram</li><li><code>NOTIFY_TELEGRAM_CHAN</code>: If enabling telegram notification for administrators, need to configure the corresponding Channel id, just fill in the id part after <code>t.me/xxx</code>, such as <code>pseudoyuchat</code></li></ul></li><li>Email notification for users, refer to <a href=https://remark42.com/docs/configuration/email/>this part of the documentation</a> for configuring email SMTP, etc.<ul><li><code>NOTIFY_USERS</code>: Method of notifying users, I chose email, i.e., email notification, so you need to configure the SMTP below</li><li><code>NOTIFY_EMAIL_FROM</code>: Sending address for email notifications</li></ul></li></ul><h4 id=email-smtp-configuration>Email SMTP Configuration</h4><p>The email login and email notification mentioned above both need to configure SMTP server, this part can also be configured according to your email service provider <a href=https://remark42.com/docs/configuration/email/>referring to the documentation</a>.</p><ul><li><code>SMTP_HOST</code>: SMTP server address</li><li><code>SMTP_PORT</code>: SMTP server port</li><li><code>SMTP_TLS</code>: Whether to enable TLS</li><li><code>SMTP_USERNAME</code>: SMTP username</li><li><code>SMTP_PASSWORD</code>: SMTP password</li></ul><h3 id=import-environment-variables-to-service>Import Environment Variables to Service</h3><p>After completing the environment variable configuration according to the above instructions, run the following command in the directory where the configuration file and environment variable file are located to import the environment variables:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>fly secrets import &lt; prod.env
</span></span></code></pre></div><p><img src=https://image.pseudoyu.com/images/fly_secret_import.png alt=fly_secret_import></p><p><img src=https://image.pseudoyu.com/images/deploy_status_remark42.png alt=deploy_status_remark42></p><p>After execution, check the service status in the fly.io console. If the status is <code>Deployed</code>, it indicates successful deployment.</p><h3 id=configure-custom-domain-optional>Configure Custom Domain (Optional)</h3><p>If you don&rsquo;t want to use the default domain provided by fly.io, you can configure a custom domain.</p><p><img src=https://image.pseudoyu.com/images/custom_domain_flyio.png alt=custom_domain_flyio></p><p>Enter the fly.io console, select the <code>yu-remark42-01</code> service you just deployed, click the <code>Certificates</code> option on the left, then click <code>Add a Certificate</code> in the upper right corner, and follow the prompts to add a custom domain.</p><p><img src=https://image.pseudoyu.com/images/custom_domain_dns_in_fly.png alt=custom_domain_dns_in_fly></p><p>After clicking <code>Create Certificate</code>, there will be a page showing the DNS records you need to add. Follow the prompts to add them.</p><p><img src=https://image.pseudoyu.com/images/cloudflare_dns_remark42.png alt=cloudflare_dns_remark42></p><p><img src=https://image.pseudoyu.com/images/flyio_certificate_success.png alt=flyio_certificate_success></p><p>For example, my domain is hosted on Cloudflare, I added two DNS records according to the prompts. Return to the page and click <code>Check again</code> or wait for a while and refresh to view. If all show green, the configuration is successful.</p><p><img src=https://image.pseudoyu.com/images/change_remark_url.png alt=change_remark_url></p><p>At this point, we can modify <code>REMARK_URL</code> to the custom domain in <code>fly.toml</code>, then execute the following command to redeploy the service. Any subsequent changes to the configuration file can be updated using this command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>fly deploy
</span></span></code></pre></div><h2 id=configuring-remark42-in-your-blog>Configuring Remark42 in Your Blog</h2><p>Now that we&rsquo;ve completed the deployment of the Remark42 service, we need to add the Remark42 comment component to our blog posts. I&rsquo;ll use my Hugo blog as an example.</p><h3 id=define-hugo-theme-comments-component>Define Hugo Theme Comments Component</h3><p>I created a new <code>comments.html</code> file in the <code>layouts/partials</code> directory of my Hugo blog to define the Remark42 comment component:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;comments&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>span</span><span class=p>&gt;</span>Comments<span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;counter&#34;</span><span class=p>&gt;&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;remark42__counter&#34;</span> <span class=na>data-url</span><span class=o>=</span><span class=s>&#34;{{ .Permalink }}&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>span</span><span class=p>&gt;&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;remark42&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>remark_config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>host</span><span class=o>:</span> <span class=s1>&#39;https://comments.pseudoyu.com&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>site_id</span><span class=o>:</span> <span class=s1>&#39;pseudoyu.com&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>components</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;embed&#39;</span><span class=p>,</span> <span class=s1>&#39;counter&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nx>max_shown_comments</span><span class=o>:</span> <span class=mi>20</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>simple_view</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>theme</span><span class=o>:</span> <span class=s1>&#39;light&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// init or reset remark42
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>remark42</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>REMARK42</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>remark42</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>remark42</span><span class=p>.</span><span class=nx>destroy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nx>remark42</span><span class=p>.</span><span class=nx>createInstance</span><span class=p>(</span><span class=nx>remark_config</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>component</span> <span class=k>of</span> <span class=nx>remark_config</span><span class=p>.</span><span class=nx>components</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kd>var</span> <span class=nx>d</span> <span class=o>=</span> <span class=nb>document</span><span class=p>,</span> <span class=nx>s</span> <span class=o>=</span> <span class=nx>d</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s1>&#39;script&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nx>s</span><span class=p>.</span><span class=nx>src</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nx>remark_config</span><span class=p>.</span><span class=nx>host</span><span class=si>}</span><span class=sb>/web/</span><span class=si>${</span><span class=nx>component</span><span class=si>}</span><span class=sb>.mjs`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=nx>s</span><span class=p>.</span><span class=nx>type</span> <span class=o>=</span> <span class=s1>&#39;module&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=nx>s</span><span class=p>.</span><span class=nx>defer</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=c1>// prevent the &lt;script&gt; from loading mutiple times by InstantClick
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=nx>s</span><span class=p>.</span><span class=nx>setAttribute</span><span class=p>(</span><span class=s1>&#39;data-no-instant&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=nx>d</span><span class=p>.</span><span class=nx>head</span><span class=p>.</span><span class=nx>appendChild</span><span class=p>(</span><span class=nx>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>})();</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>The <code>host</code> and <code>site_id</code> in <code>remark_config</code> need to be modified according to your actual configuration. Other parts of the configuration can remain unchanged or be adjusted according to the documentation.</p><p>After configuring the <code>comments</code> component, include it at the bottom of the article in <code>layouts/posts/single.html</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>{{ partial &#34;comments.html&#34; . }}
</span></span></code></pre></div><p><img src=https://image.pseudoyu.com/images/add_comments_code_in_hugo.png alt=add_comments_code_in_hugo></p><p>The general position is as shown in the image. If you&rsquo;re using another theme or blog system, you&rsquo;ll need to find the corresponding template file for your articles and modify it.</p><h3 id=local-previewdeploy-website>Local Preview/Deploy Website</h3><p><img src=https://image.pseudoyu.com/images/test_remark42_embedded.png alt=test_remark42_embedded></p><p>At this point, you can preview locally or deploy the website to check if the comment system is displaying correctly. With this, our service deployment is complete.</p><h3 id=get-user-id-and-configure-admin>Get User ID and Configure Admin</h3><p><img src=https://image.pseudoyu.com/images/get_user_id_remark42.png alt=get_user_id_remark42></p><p>After logging in, authorizing, and testing comments, you can click on the avatar in Remark42 to open the management page. Double-click and then <code>CMD/Ctrl+C</code> to get the User ID starting with <code>github_</code> or other platforms. You can configure this in <code>ADMIN_SHARED_ID</code> (change the <code>fly.toml</code> configuration file and run <code>fly deploy</code> to redeploy). This will make you an administrator, and administrators have the authority to delete and manage other users&rsquo; comments.</p><h2 id=other-considerations>Other Considerations</h2><p>I exported the comment data from Cusdis in JSON format according to certain conditions, and converted and migrated the format through a Go program, thus preserving all previous comments.</p><p>Because Cusdis itself doesn&rsquo;t provide an export function and the migration need is too niche, I didn&rsquo;t directly contribute code to the upstream or write it into a complete script. Friends with similar needs can refer to this PR for processing - &ldquo;feat: add cusdis to remark42 migrator support by pseudoyu · Pull Request #1 · pseudoyu/remark42&rdquo;.</p><h2 id=conclusion>Conclusion</h2><p>The above is the process of building my blog&rsquo;s comment system. The setup and configuration of a comment system are relatively complex, and the configuration method in this article may become outdated over time. If you encounter problems, refer more to the <a href=https://remark42.com/docs/getting-started/installation/>official documentation</a>.</p><p>This is one of my blog building and deployment series tutorials. If you&rsquo;re interested in building data statistics systems, in-blog search, etc., please stay tuned. I hope this can be of reference to everyone.</p></articl><h2>Related Posts</h2><dl class=row></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl><dt class=col-md-3>2024-08-06</dt><dd class=col-md-9><a href=/en/2024/08/06/deploy_web_statistics_system_using_goatcounter_and_zeabur/>Setting up a Website Analytics System with GoatCounter and Zeabur</a></dd></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl><dt class=col-md-3>2024-07-02</dt><dd class=col-md-9><a href=/en/2024/07/02/protect_your_image_using_webp_and_cloudflare_waf/>Adding Privacy and Copyright Protection to Your Image Hosting with WebP Cloud and Cloudflare WAF</a></dd></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl><dt class=col-md-3>2024-06-30</dt><dd class=col-md-9><a href=/en/2024/06/30/free_image_hosting_system_using_r2_webp_cloud_and_picgo/>Build Your Free Image Hosting System from Scratch (Cloudflare R2 + WebP Cloud + PicGo)</a></dd></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl><dt class=col-md-3>2022-05-29</dt><dd class=col-md-9><a href=/en/2022/05/29/deploy_your_blog_using_hugo_and_github_action/>Hugo + GitHub Action: Building Your Automated Blog Publishing System</a></dd></dl></dl></dl></dl></dl></dl><dt class=col-md-3>2022-05-24</dt><dd class=col-md-9><a href=/en/2022/05/24/free_and_lightweight_blog_comment_system_using_cusdis_and_railway/>Lightweight Open Source Free Blog Comment System Solution (Cusdis + Railway)</a></dd></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl><div class=author-card><div class=underline></div><div class=author-box><div class=author-image><a href=https://www.pseudoyu.com><img src=/images/author.webp alt=pseudoyu></a></div><div class=author-content><p class=author-title>Author</p><p class=author-name>pseudoyu</p><p class=author-desc>Backend & Smart Contract Developer, MSc Graduate in ECIC(Electronic Commerce and Internet Computing) @ The University of Hong Kong (HKU). Love to learn and build things. <a href=https://github.com/pseudoyu>Follow me on GitHub</a></p></div></div></div><div align=center><div class=comment-underline></div></div><br><div class=comments><div class=title><span>Comments</span>
<span class=counter><span class=remark42__counter data-url=https://www.pseudoyu.com/en/2024/07/22/free_commenting_system_using_remark42_and_flyio/></span></span></div><div id=remark42></div></div><script>var remark_config={host:"https://comments.pseudoyu.com",site_id:"pseudoyu.com",components:["embed","counter"],max_shown_comments:20,simple_view:!0,theme:"light"}</script><script>(function(){const t=window.REMARK42;if(t)t.destroy(),t.createInstance(remark_config);else for(const t of remark_config.components){var n=document,e=n.createElement("script");e.src=`${remark_config.host}/web/${t}.mjs`,e.type="module",e.defer=!0,e.setAttribute("data-no-instant",""),n.head.appendChild(e)}})()</script></div></main><div class="footer gradient-2"><div class="container footer-container"><div class=row><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>Sitemap</div><ul class=list-unstyled><li><a href=https://www.pseudoyu.com/en/tags/>Tags</a></li><li><a href=https://www.pseudoyu.com/en/categories/>Categories</a></li><li><a rel=alternate type=application/rss+xml href=https://www.pseudoyu.com/en/index.xml><i class="fas fa-rss-square"></i> RSS Feed</a></li></ul></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>Social</div><ul class=list-unstyled><li><a href=https://t.me/pseudoyulife rel=noopener target=_blank>Telegram</a></li><li><a href=https://twitter.com/pseudo_yu rel=noopener target=_blank>Twitter</a></li><li><a href=https://www.instagram.com/pseudo.yu/ rel=noopener target=_blank>Instagram</a></li><li><a href=https://space.bilibili.com/5374948/ rel=noopener target=_blank>BiliBili</a></li></ul></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>Links</div><ul class=list-unstyled><li><a href=https://github.com/pseudoyu rel=noopener target=_blank>Yu's GitHub</a></li></ul></div><div class="col-xs-12 col-sm-3 col-md-3 col-lg-3"><p class="pull-right text-right"><small><em><a href="https://stats.pseudoyu.com?access-token=2m1u5i2k413q0733h2a3332w3m1t6r634g1m6n" rel=noopener target=_blank>Yu's blog analytics</a></em></small><br><small><em>Powered by <a href=https://gohugo.io rel=noopener target=_blank>Hugo</a> - <a href=https://github.com/shaform/hugo-theme-den rel=noopener target=_blank>den</a></em></small><br><small><em><a href=https://www.hku.hk rel=noopener target=_blank>The University of Hong Kong</a> - <a href=https://www.cs.hku.hk rel=noopener target=_blank>CS</a></em></small><br><small>&copy;
Yu Zhang
2020 -
2024</small></p></div><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" id=scroll-top class=scroll-top accesskey=g><span class=arrow-icon></span></a>
<script>var mybutton=document.getElementById("scroll-top");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></div></div></div><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script></body></html>