<!doctype html><html lang=de itemscope itemtype=http://schema.org/WebPage><head><meta name=generator content="Hugo 0.105.0"><meta charset=utf-8><title>Solidity Smart Contract Entwicklung - Verwendung des Hardhat Frameworks · Pseudoyu</title><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><script data-goatcounter=https://stats.pseudoyu.com/count async src=//stats.pseudoyu.com/count.js></script><meta name=description content="&amp;#39;Here After Us - Mayday&amp;#39; Vorwort Nach den vorherigen Artikeln über Smart Contract Grundlagen, Web3.py und ethers.js haben wir die grundlegenden Kenntnisse zur direkten Interaktion mit Blockchain-Netzwerken durch Programme erworben. Für diejenigen, die damit nicht vertraut sind, können Sie folgende Artikel nachlesen:
Solidity Smart Contract Entwicklung - Grundlagen Solidity Smart Contract Entwicklung - Beherrschung von Web3.py Solidity Smart Contract Entwicklung - Beherrschung von ethers.js In realen komplexen Geschäftsszenarien verwenden wir jedoch oft weiter gekapselte Frameworks wie HardHat, Brownie, Truffle usw."><meta name=keywords content="hugo,blockchain,programming"><link rel=canonical href=https://www.pseudoyu.com/de/2022/06/09/learn_solidity_from_scratch_hardhat/><link rel=alternate href=https://www.pseudoyu.com/zh/2022/06/09/learn_solidity_from_scratch_hardhat/ hreflang=zh><link rel=alternate href=https://www.pseudoyu.com/en/2022/06/09/learn_solidity_from_scratch_hardhat/ hreflang=en><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css integrity=sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css integrity=sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ crossorigin=anonymous><link rel=stylesheet href=https://www.pseudoyu.com/css/den.css><link rel=stylesheet href=https://www.pseudoyu.com/css/custom.css><meta property="og:title" content="Solidity Smart Contract Entwicklung - Verwendung des Hardhat Frameworks"><meta property="og:description" content="'Here After Us - Mayday' Vorwort Nach den vorherigen Artikeln über Smart Contract Grundlagen, Web3.py und ethers.js haben wir die grundlegenden Kenntnisse zur direkten Interaktion mit Blockchain-Netzwerken durch Programme erworben. Für diejenigen, die damit nicht vertraut sind, können Sie folgende Artikel nachlesen:
Solidity Smart Contract Entwicklung - Grundlagen Solidity Smart Contract Entwicklung - Beherrschung von Web3.py Solidity Smart Contract Entwicklung - Beherrschung von ethers.js In realen komplexen Geschäftsszenarien verwenden wir jedoch oft weiter gekapselte Frameworks wie HardHat, Brownie, Truffle usw."><meta property="og:type" content="article"><meta property="og:url" content="https://www.pseudoyu.com/de/2022/06/09/learn_solidity_from_scratch_hardhat/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-09T14:38:10+08:00"><meta property="article:modified_time" content="2022-06-09T14:38:10+08:00"><meta itemprop=name content="Solidity Smart Contract Entwicklung - Verwendung des Hardhat Frameworks"><meta itemprop=description content="'Here After Us - Mayday' Vorwort Nach den vorherigen Artikeln über Smart Contract Grundlagen, Web3.py und ethers.js haben wir die grundlegenden Kenntnisse zur direkten Interaktion mit Blockchain-Netzwerken durch Programme erworben. Für diejenigen, die damit nicht vertraut sind, können Sie folgende Artikel nachlesen:
Solidity Smart Contract Entwicklung - Grundlagen Solidity Smart Contract Entwicklung - Beherrschung von Web3.py Solidity Smart Contract Entwicklung - Beherrschung von ethers.js In realen komplexen Geschäftsszenarien verwenden wir jedoch oft weiter gekapselte Frameworks wie HardHat, Brownie, Truffle usw."><meta itemprop=datePublished content="2022-06-09T14:38:10+08:00"><meta itemprop=dateModified content="2022-06-09T14:38:10+08:00"><meta itemprop=wordCount content="2102"><meta itemprop=keywords content="blockchain,solidity,ethereum,web3,smart contract,javascript,ethers.js,hardhat,yarn,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Solidity Smart Contract Entwicklung - Verwendung des Hardhat Frameworks"><meta name=twitter:description content="'Here After Us - Mayday' Vorwort Nach den vorherigen Artikeln über Smart Contract Grundlagen, Web3.py und ethers.js haben wir die grundlegenden Kenntnisse zur direkten Interaktion mit Blockchain-Netzwerken durch Programme erworben. Für diejenigen, die damit nicht vertraut sind, können Sie folgende Artikel nachlesen:
Solidity Smart Contract Entwicklung - Grundlagen Solidity Smart Contract Entwicklung - Beherrschung von Web3.py Solidity Smart Contract Entwicklung - Beherrschung von ethers.js In realen komplexen Geschäftsszenarien verwenden wir jedoch oft weiter gekapselte Frameworks wie HardHat, Brownie, Truffle usw."></head><body><div class=header-container style=background:linear-gradient(rgba(0,0,0,.2),rgba(0,0,0,.2)),url(https://www.pseudoyu.com/images/background.png);background-position:50%;background-size:cover><div class=container><nav class="header-nav navbar navbar-expand-md navbar-dark light-dark"><div class="header-logo navbar-brand"><a class=float-left href=https://www.pseudoyu.com/de/><img class="mr20 header-logo-image" src=https://www.pseudoyu.com/images/icon.png alt=logo>
Pseudoyu</a></div><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="nav-menu collapse navbar-collapse" id=navbarNav><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/de/category/ideas/>Ideen</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/de/category/tools/>Tools</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/de/category/develop/>Code</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/de/links/>Links</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/de/search/>Suche</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/de/about/>Über</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/zh/><i class="fas fa-globe"></i> 简</a></li><li class=nav-item><a class=nav-link href=https://www.pseudoyu.com/en/><i class="fas fa-globe"></i> EN</a></li></ul></div></nav></div><div class="container header-wrapper"><div class=row><div class=col-lg-12><div class=header-content><h1 class=header-title>Solidity Smart Contract Entwicklung - Verwendung des Hardhat Frameworks</h1><p class=header-date>Autor:
pseudoyu
| <span>2102 Wörter, 10 Minuten</span>
| <span class=remark42__counter data-url=https://www.pseudoyu.com/de/2022/06/09/learn_solidity_from_scratch_hardhat/></span> Kommentare
| 2022-06-09
| Kategorie:
<a href=https://www.pseudoyu.com/de/category/develop/>Develop</a></p><div class=header-underline></div><div class=clearfix></div><p class="float-right header-tags"><i class="fas fa-tags" aria-hidden=true></i>
<a href=https://www.pseudoyu.com/de/tag/blockchain/>blockchain</a>,
<a href=https://www.pseudoyu.com/de/tag/ethereum/>ethereum</a>,
<a href=https://www.pseudoyu.com/de/tag/ethers.js/>ethers.js</a>,
<a href=https://www.pseudoyu.com/de/tag/hardhat/>hardhat</a>,
<a href=https://www.pseudoyu.com/de/tag/javascript/>javascript</a>,
<a href=https://www.pseudoyu.com/de/tag/smart-contract/>smart contract</a>,
<a href=https://www.pseudoyu.com/de/tag/solidity/>solidity</a>,
<a href=https://www.pseudoyu.com/de/tag/web3/>web3</a>,
<a href=https://www.pseudoyu.com/de/tag/yarn/>yarn</a></p><div class=clearfix></div><p class="float-right translations"><i class="fas fa-language" aria-hidden=true></i>
Übersetzungen:
<a href=https://www.pseudoyu.com/zh/2022/06/09/learn_solidity_from_scratch_hardhat/>ZH</a>, <a href=https://www.pseudoyu.com/en/2022/06/09/learn_solidity_from_scratch_hardhat/>EN</a></p></div></div></div></div></div><main><div class="container content"><articl data-pagefind-body><figure><audio controls preload=metadata><source src=/audios/here_after_us.mp3 type=audio/mpeg></audio><i><figcaption>'Here After Us - Mayday'</figcaption></i></figure><h2 id=vorwort>Vorwort</h2><p>Nach den vorherigen Artikeln über Smart Contract Grundlagen, Web3.py und ethers.js haben wir die grundlegenden Kenntnisse zur direkten Interaktion mit Blockchain-Netzwerken durch Programme erworben. Für diejenigen, die damit nicht vertraut sind, können Sie folgende Artikel nachlesen:</p><ul><li><a href=https://www.pseudoyu.com/de/2022/05/25/learn_solidity_from_scratch_basic/>Solidity Smart Contract Entwicklung - Grundlagen</a></li><li><a href=https://www.pseudoyu.com/de/2022/05/30/learn_solidity_from_scratch_web3py/>Solidity Smart Contract Entwicklung - Beherrschung von Web3.py</a></li><li><a href=https://www.pseudoyu.com/de/2022/06/08/learn_solidity_from_scratch_ethersjs/>Solidity Smart Contract Entwicklung - Beherrschung von ethers.js</a></li></ul><p>In realen komplexen Geschäftsszenarien verwenden wir jedoch oft weiter gekapselte Frameworks wie HardHat, Brownie, Truffle usw. HardHat ist am weitesten verbreitet und verfügt über die leistungsfähigsten Plugin-Erweiterungen. Diese Serie wird sich ab diesem Artikel auf die Verwendung und Best Practices des Hardhat-Frameworks konzentrieren, und dieser Artikel wird dessen Installation, Konfiguration und Verwendung anhand eines einfachen Beispiels abschließen.</p><p>Dieser Artikel ist eine Zusammenfassung des Lernens aus <a href=https://twitter.com/PatrickAlphaC>Patrick Collins</a>&rsquo; Tutorial <a href="https://www.youtube.com/watch?v=gyMwXuJrbJQ">&ldquo;Learn Blockchain, Solidity, and Full Stack Web3 Development with JavaScript&rdquo;</a>. Es wird dringend empfohlen, das originale Tutorial-Video für weitere Details anzusehen.</p><p>Sie können <a href=https://github.com/pseudoyu/learn-solidity/tree/master/hardhat_simple_storage>hier</a> auf das Code-Repository für dieses Test-Demo zugreifen.</p><h2 id=einführung-in-hardhat>Einführung in Hardhat</h2><p><img src=https://image.pseudoyu.com/images/hardhat_homepage.png alt=hardhat_homepage></p><p>Hardhat ist eine JavaScript-basierte Entwicklungsumgebung für Smart Contracts, die zur flexiblen Kompilierung, Bereitstellung, Testung und Fehlersuche von EVM-basierten Smart Contracts verwendet werden kann. Es bietet eine Reihe von Toolchains zur Integration von Code mit externen Werkzeugen und bietet ein reichhaltiges Plugin-Ökosystem zur Verbesserung der Entwicklungseffizienz. Darüber hinaus stellt es auch einen lokalen Hardhat-Netzwerkknoten bereit, der Ethereum simuliert und leistungsstarke lokale Debugging-Fähigkeiten bietet.</p><p>Seine GitHub-Adresse ist <a href=https://github.com/NomicFoundation/hardhat>NomicFoundation/hardhat</a>, und Sie können seine <a href=https://hardhat.org/getting-started>offizielle Dokumentation</a> besuchen, um mehr zu erfahren.</p><h2 id=verwendung-von-hardhat>Verwendung von Hardhat</h2><h3 id=initialisierung-des-projekts>Initialisierung des Projekts</h3><p>Um ein Hardhat-Projekt von Grund auf zu erstellen, müssen wir zunächst die <code>node.js</code> und <code>yarn</code> Umgebungen vorinstallieren. Dieser Teil kann gemäß den offiziellen Anweisungen basierend auf Ihrer Systemumgebung installiert werden.</p><p>Zuerst müssen wir das Projekt initialisieren und das <code>hardhat</code> Abhängigkeitspaket installieren.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yarn init
</span></span><span class=line><span class=cl>yarn add --dev hardhat
</span></span></code></pre></div><p><img src=https://image.pseudoyu.com/images/yarn_add.png alt=yarn_add></p><h3 id=initialisierung-von-hardhat>Initialisierung von Hardhat</h3><p>Dann müssen wir <code>yarn hardhat</code> ausführen, um durch interaktive Befehle zu initialisieren. Konfigurieren Sie es entsprechend den Projektanforderungen. Für unser Test-Demo wählen wir die Standardwerte.</p><p><img src=https://image.pseudoyu.com/images/hardhat_project_init.png alt=hardhat_project_init></p><h3 id=optimierung-der-code-formatierung>Optimierung der Code-Formatierung</h3><h4 id=vs-code-konfiguration>VS Code Konfiguration</h4><p>Ich entwickle Code lokal mit VS Code. Sie können den Code formatieren, indem Sie die Plugins <code>Solidity + Hardhat</code> und <code>Prettier</code> installieren. Sie können die VS Code-Einstellungen öffnen und die folgende Formatierungskonfiguration in <code>settings.json</code> hinzufügen:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;[solidity]&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;editor.defaultFormatter&#34;</span><span class=p>:</span> <span class=s2>&#34;NomicFoundation.hardhat-solidity&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;[javascript]&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;editor.defaultFormatter&#34;</span><span class=p>:</span> <span class=s2>&#34;esbenp.prettier-vscode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=projektkonfiguration>Projektkonfiguration</h4><p>Um die Code-Formatierungsstile von Entwicklern, die verschiedene Projekte verwenden, zu vereinheitlichen, können wir auch <code>prettier</code> und das <code>prettier-plugin-solidity</code> Plugin für das Projekt konfigurieren:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yarn add --dev prettier prettier-plugin-solidity
</span></span></code></pre></div><p><img src=https://image.pseudoyu.com/images/yarn_add_prettier_plugin.png alt=yarn_add_prettier_plugin></p><p>Nach dem Hinzufügen der Abhängigkeiten können Sie <code>.prettierrc</code> und <code>.prettierignore</code> Konfigurationsdateien im Projektverzeichnis hinzufügen, um die Formatierung zu vereinheitlichen:</p><p>Meine <code>.prettierrc</code> Konfiguration ist:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;tabWidth&#34;</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;useTabs&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;semi&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;singleQuote&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Meine <code>.prettierignore</code> Konfiguration ist:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>node_modules
</span></span><span class=line><span class=cl>package.json
</span></span><span class=line><span class=cl>img
</span></span><span class=line><span class=cl>artifacts
</span></span><span class=line><span class=cl>cache
</span></span><span class=line><span class=cl>coverage
</span></span><span class=line><span class=cl>.env
</span></span><span class=line><span class=cl>.*
</span></span><span class=line><span class=cl>README.md
</span></span><span class=line><span class=cl>coverage.json
</span></span></code></pre></div><h3 id=kompilierung-von-verträgen>Kompilierung von Verträgen</h3><p>Es ist nicht notwendig, den <code>compile</code> Befehl wie in <code>ethers.js</code> anzupassen. HardHat bietet einen eingebauten <code>compile</code> Befehl. Sie können Verträge im Verzeichnis <code>contracts</code> platzieren und sie dann mit dem Befehl <code>yarn hardhat compile</code> kompilieren:</p><p><img src=https://image.pseudoyu.com/images/hardhat_compile_contract.png alt=hardhat_compile_contract></p><h3 id=hinzufügen-von-dotenv-unterstützung>Hinzufügen von <code>dotenv</code> Unterstützung</h3><p>Bevor wir mit dem Schreiben von Bereitstellungsskripten beginnen, lassen Sie uns das <code>dotenv</code> Plugin konfigurieren. Auf diese Weise können wir <code>dotenv</code> verwenden, um Umgebungsvariablen zu erhalten. Während der Entwicklung werden wir mit vielen privaten Informationen umgehen, wie zum Beispiel privaten Schlüsseln usw. Wir möchten sie in einer <code>.env</code> Datei speichern oder direkt im Terminal setzen, wie zum Beispiel unser <code>RINKEBY_PRIVATE_TOKEN</code>. Auf diese Weise können wir <code>process.env.RINKEBY_PRIVATE_TOKEN</code> verwenden, um den Wert im Bereitstellungsskript zu erhalten, ohne ihn explizit im Code zu schreiben, was das Risiko einer Privatsphärenverletzung reduziert.</p><h4 id=installation-von-dotenv>Installation von <code>dotenv</code></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yarn add --dev dotenv
</span></span></code></pre></div><p><img src=https://image.pseudoyu.com/images/yarn_add_dotenv.png alt=yarn_add_dotenv></p><h4 id=festlegen-von-umgebungsvariablen>Festlegen von Umgebungsvariablen</h4><p>In der <code>.env</code> Datei können wir Umgebungsvariablen festlegen, wie zum Beispiel:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>RINKEBY_RPC_URL=url
</span></span><span class=line><span class=cl>RINKEBY_PRIVATE_KEY=0xkey
</span></span><span class=line><span class=cl>ETHERSCAN_API_KEY=key
</span></span><span class=line><span class=cl>COINMARKETCAP_API_KEY=key
</span></span></code></pre></div><p>Wir können dann Umgebungsvariablen in <code>hardhat.config.js</code> lesen:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;dotenv&#34;</span><span class=p>).</span><span class=nx>config</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>RINKEBY_RPC_URL</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>RINKEBY_RPC_URL</span> <span class=o>||</span> <span class=s2>&#34;https://eth-rinkeby/example&#34;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>RINKEBY_PRIVATE_KEY</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>RINKEBY_PRIVATE_KEY</span> <span class=o>||</span> <span class=s2>&#34;0xkey&#34;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>ETHERSCAN_API_KEY</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>ETHERSCAN_API_KEY</span> <span class=o>||</span> <span class=s2>&#34;key&#34;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>COINMARKETCAP_API_KEY</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>COINMARKETCAP_API_KEY</span> <span class=o>||</span> <span class=s2>&#34;key&#34;</span>
</span></span></code></pre></div><h3 id=konfiguration-der-netzwerkumgebung>Konfiguration der Netzwerkumgebung</h3><p>Oft müssen unsere Verträge auf verschiedenen Blockchain-Netzwerken laufen, wie lokale Tests, Entwicklungs- und Produktionsumgebungen. Hardhat bietet auch eine bequeme Möglichkeit, Netzwerkumgebungen zu konfigurieren.</p><h4 id=starten-des-netzwerks>Starten des Netzwerks</h4><p>Wir können direkt ein Skript ausführen, um ein Netzwerk zu starten, das mit Hardhat mitgeliefert wird, aber dieses Netzwerk existiert nur während der Skriptausführung. Um ein lokal nachhaltiges Netzwerk zu starten, müssen Sie den Befehl <code>yarn hardhat node</code> ausführen:</p><p><img src=https://image.pseudoyu.com/images/hardhat_localhost_node.png alt=hardhat_localhost_node></p><p>Nach der Ausführung werden Testnetzwerke und Testkonten für die anschließende Entwicklung und Fehlersuche generiert.</p><p>Wir können auch unsere eigenen Testnetzwerk-Knoten über Plattformen wie Alchemy oder Infura generieren und ihre <code>RPC_URL</code> für die Programmverbindung aufzeichnen.</p><h4 id=definition-von-netzwerken>Definition von Netzwerken</h4><p>Nach der Vorbereitung der Netzwerkumgebung können wir Netzwerke in der Projektkonfiguration <code>hardhat.config.js</code> definieren:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>RINKEBY_RPC_URL</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>RINKEBY_RPC_URL</span> <span class=o>||</span> <span class=s2>&#34;https://eth-rinkeby/example&#34;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>RINKEBY_PRIVATE_KEY</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>RINKEBY_PRIVATE_KEY</span> <span class=o>||</span> <span class=s2>&#34;0xkey&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>defaultNetwork</span><span class=o>:</span> <span class=s2>&#34;hardhat&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>networks</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>locakhost</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>url</span><span class=o>:</span> <span class=s2>&#34;http://localhost:8545&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>chainId</span><span class=o>:</span> <span class=mi>31337</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>rinkeby</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>url</span><span class=o>:</span> <span class=nx>RINKEBY_RPC_URL</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>accounts</span><span class=o>:</span> <span class=p>[</span><span class=nx>RINKEBY_PRIVATE_KEY</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nx>chainId</span><span class=o>:</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...,
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h3 id=skripte>Skripte</h3><p>In einem Hardhat-Projekt können wir Funktionen wie die Bereitstellung implementieren, indem wir Skripte im Verzeichnis <code>scripts</code> schreiben und Skripte durch bequeme Befehle ausführen.</p><h4 id=schreiben-von-bereitstellungsskripten>Schreiben von Bereitstellungsskripten</h4><p>Als Nächstes beginnen wir mit dem Schreiben des <code>deploy.js</code> Skripts.</p><p>Zuerst müssen wir notwendige Pakete aus <code>hardhat</code> importieren:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>ethers</span><span class=p>,</span> <span class=nx>run</span><span class=p>,</span> <span class=nx>network</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;hardhat&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>Dann schreiben wir die <code>main</code> Methode, die unsere Kern-Bereitstellungslogik enthält:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>SimpleStorageFactory</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>ethers</span><span class=p>.</span><span class=nx>getContractFactory</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;SimpleStorage&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Deploying SimpleStorage Contract...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>simpleStorage</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>SimpleStorageFactory</span><span class=p>.</span><span class=nx>deploy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>simpleStorage</span><span class=p>.</span><span class=nx>deployed</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;SimpleStorage Contract deployed at:&#34;</span><span class=p>,</span> <span class=nx>simpleStorage</span><span class=p>.</span><span class=nx>address</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Aktuellen Wert abrufen
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>currentValue</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>simpleStorage</span><span class=p>.</span><span class=nx>retrieve</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Current value:&#34;</span><span class=p>,</span> <span class=nx>currentValue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Wert setzen
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>transactionResponse</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>simpleStorage</span><span class=p>.</span><span class=nx>store</span><span class=p>(</span><span class=mi>7</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>transactionResponse</span><span class=p>.</span><span class=nx>wait</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Aktualisierten Wert abrufen
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>updatedValue</span> <span class=o>=</span> <span class=kr>await</span> <span class=kr>await</span> <span class=nx>simpleStorage</span><span class=p>.</span><span class=nx>retrieve</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Updated value:&#34;</span><span class=p>,</span> <span class=nx>updatedValue</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Schließlich führen wir unsere <code>main</code> Methode aus:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=k>catch</span><span class=p>((</span><span class=nx>error</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span></code></pre></div><h4 id=ausführen-von-skripten>Ausführen von Skripten</h4><p>Nach Abschluss des Skriptschreibens können Sie das Skript mit dem von Hardhat bereitgestellten <code>run</code> Befehl ausführen.</p><p>Wenn kein Netzwerkparameter hinzugefügt wird, wird standardmäßig das <code>hardhat</code> Netzwerk verwendet. Sie können das Netzwerk mit dem Parameter <code>--network</code> angeben:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yarn hardhat run scripts/deploy.js --network rinkeby
</span></span></code></pre></div><p><img src=https://image.pseudoyu.com/images/hardhat_deploy_rinkeby.png alt=hardhat_deploy_rinkeby></p><h3 id=hinzufügen-von-etherscan-vertragsverifizierungsunterstützung>Hinzufügen von Etherscan-Vertragsverifizierungsunterstützung</h3><p>Nach der Bereitstellung des Vertrags im Rinkeby-Testnetzwerk können Sie die Vertragsadresse auf Etherscan anzeigen und verifizieren. Wir können dies über die Website tun, aber Hardhat bietet Plugin-Unterstützung, die es bequemer macht, Verifizierungsoperationen durchzuführen.</p><h4 id=installation-des-hardhat-etherscan-plugins>Installation des hardhat-etherscan Plugins</h4><p>Wir installieren das Plugin mit dem Befehl <code>yarn add --dev @nomiclabs/hardhat-etherscan</code>.</p><p><img src=https://image.pseudoyu.com/images/yarn_add_etherscan_verify_support.png alt=yarn_add_etherscan_verify_support></p><h4 id=aktivierung-der-etherscan-vertragsverifizierungsunterstützung>Aktivierung der Etherscan-Vertragsverifizierungsunterstützung</h4><p>Nach der Installation müssen wir in <code>hardhat.config.js</code> konfigurieren:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@nomiclabs/hardhat-etherscan&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...,
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>etherscan</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>apiKey</span><span class=o>:</span> <span class=nx>ETHERSCAN_API_KEY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...,
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h4 id=definition-der-verifizierungsmethode>Definition der Verifizierungsmethode</h4><p>Als Nächstes müssen wir eine <code>verify</code> Methode im Bereitstellungsskript <code>deploy.js</code> hinzufügen.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>ethers</span><span class=p>,</span> <span class=nx>run</span><span class=p>,</span> <span class=nx>network</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;hardhat&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>verify</span><span class=p>(</span><span class=nx>contractAddress</span><span class=p>,</span> <span class=nx>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Verifying SimpleStorage Contract...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>run</span><span class=p>(</span><span class=s2>&#34;verify:verify&#34;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>address</span><span class=o>:</span> <span class=nx>contractAddress</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>constructorArguements</span><span class=o>:</span> <span class=nx>args</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>message</span><span class=p>.</span><span class=nx>toLowerCase</span><span class=p>().</span><span class=nx>includes</span><span class=p>(</span><span class=s2>&#34;already verified!&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Already Verified!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>In dieser Methode rufen wir die <code>run</code> Methode aus dem <code>hardhat</code> Paket auf, übergeben einen <code>verify</code> Befehl und übergeben einen Parameter <code>{ address: contractAddress, constructorArguements: args }</code>. Da unser Vertrag möglicherweise bereits auf Etherscan verifiziert wurde, führen wir eine <code>try...catch...</code> Fehlerbehandlung durch. Wenn er bereits verifiziert ist, wird ein Fehler geworfen und eine Meldung ausgegeben, ohne unseren Bereitstellungsprozess zu beeinträchtigen.</p><h4 id=einrichten-des-post-deployment-aufrufs>Einrichten des Post-Deployment-Aufrufs</h4><p>Nachdem wir unsere <code>verify</code> Methode definiert haben, können wir sie im Bereitstellungsskript aufrufen:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>network</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>chainId</span> <span class=o>===</span> <span class=mi>4</span> <span class=o>&amp;&amp;</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>ETHERSCAN_API_KEY</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>simpleStorage</span><span class=p>.</span><span class=nx>deployTransaction</span><span class=p>.</span><span class=nx>wait</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>verify</span><span class=p>(</span><span class=nx>simpleStorage</span><span class=p>.</span><span class=nx>address</span><span class=p>,</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p>Hier haben wir zwei besondere Behandlungen vorgenommen.</p><p>Erstens müssen wir den Vertrag nur im <code>rinkeby</code> Netzwerk verifizieren, nicht in lokalen oder anderen Netzwerkumgebungen. Daher prüfen wir <code>network.config.chainId</code>. Wenn es <code>4</code> ist, führen wir die Verifizierungsoperation durch; andernfalls nicht. Außerdem führen wir die Verifizierungsoperation nur durch, wenn eine <code>ETHERSCAN_API_KEY</code> Umgebungsvariable vorhanden ist.</p><p>Außerdem benötigt Etherscan möglicherweise etwas Zeit nach der Bereitstellung, um die Vertragsadresse zu erhalten, daher haben wir <code>.wait(6)</code> konfiguriert, um 6 Blöcke vor der Verifizierung zu warten.</p><p>Der Ausführungseffekt ist wie folgt:</p><p><img src=https://image.pseudoyu.com/images/hardhat_verify_contract_etherscan.png alt=hardhat_verify_contract_etherscan></p><p><img src=https://image.pseudoyu.com/images/verified_contract_on_etherscan.png alt=verified_contract_on_etherscan></p><p>Nach der Verifizierung durch Etherscan können wir direkt den Vertragsquellcode einsehen und damit interagieren.</p><p><img src=https://image.pseudoyu.com/images/interact_with_contract_on_etherscan.png alt=interact_with_contract_on_etherscan></p><h3 id=vertragstests>Vertragstests</h3><p>Bei Smart Contracts müssen die meisten Operationen on-chain bereitgestellt werden, mit Vermögenswerten interagieren, Gas verbrauchen, und sobald es Sicherheitslücken gibt, wird es schwerwiegende Folgen haben. Daher müssen wir detaillierte Tests an Smart Contracts durchführen.</p><p>Hardhat bietet umfassende Test- und Debugging-Tools. Wir können Testskripte im Verzeichnis <code>tests</code> schreiben und Tests mit dem Befehl <code>yarn hardhat test</code> ausführen.</p><h4 id=schreiben-von-testskripten>Schreiben von Testskripten</h4><p>Lassen Sie uns ein <code>test-deploy.js</code> Testprogramm für unser Bereitstellungsskript schreiben. Zuerst müssen wir die notwendigen Pakete importieren:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>assert</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;chai&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>ethers</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;hardhat&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>Dann schreiben wir die Testlogik:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s2>&#34;SimpleStorage&#34;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>simpleStorageFactory</span><span class=p>,</span> <span class=nx>simpleStorage</span>
</span></span><span class=line><span class=cl>    <span class=nx>beforeEach</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>simpleStorageFactory</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>ethers</span><span class=p>.</span><span class=nx>getContractFactory</span><span class=p>(</span><span class=s2>&#34;SimpleStorage&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>simpleStorage</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>simpleStorageFactory</span><span class=p>.</span><span class=nx>deploy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>it</span><span class=p>(</span><span class=s2>&#34;Should start with a favorite number of 0&#34;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>currentValue</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>simpleStorage</span><span class=p>.</span><span class=nx>retrieve</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>expectedValue</span> <span class=o>=</span> <span class=s2>&#34;0&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>assert</span><span class=p>.</span><span class=nx>equal</span><span class=p>(</span><span class=nx>currentValue</span><span class=p>.</span><span class=nx>toString</span><span class=p>(),</span> <span class=nx>expectedValue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1>// expect(currentValue.toString()).to.equal(expectedValue)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>it</span><span class=p>(</span><span class=s2>&#34;Should update when we call store&#34;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>expectedValue</span> <span class=o>=</span> <span class=s2>&#34;7&#34;</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>transactionRespense</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>simpleStorage</span><span class=p>.</span><span class=nx>store</span><span class=p>(</span><span class=nx>expectedValue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>transactionRespense</span><span class=p>.</span><span class=nx>wait</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>currentValue</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>simpleStorage</span><span class=p>.</span><span class=nx>retrieve</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>assert</span><span class=p>.</span><span class=nx>equal</span><span class=p>(</span><span class=nx>currentValue</span><span class=p>.</span><span class=nx>toString</span><span class=p>(),</span> <span class=nx>expectedValue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1>// expect(currentValue.toString()).to.equal(expectedValue)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>})</span>
</span></span></code></pre></div><p>Im Testskript von Hardhat verwenden wir <code>describe</code>, um die Testklasse zu umschließen, und <code>it</code>, um die Testmethode zu umschließen. Wir müssen sicherstellen, dass der Vertrag vor dem Testen bereitgestellt wird, daher verwenden wir die <code>beforeEach</code> Methode, um <code>simpleStorageFactory.deploy()</code> vor jeder Testmethode aufzurufen und das zurückgegebene <code>simpleStorage</code> Objekt der <code>simpleStorage</code> Variable zuzuweisen.</p><p>Wir verwenden <code>assert.equal(currentValue.toString(), expectedValue)</code>, um das Ausführungsergebnis mit dem erwarteten Ergebnis zu vergleichen. Es kann durch <code>expect(currentValue.toString()).to.equal(expectedValue)</code> ersetzt werden, was den gleichen Effekt hat.</p><p>Darüber hinaus können wir <code>it.only()</code> verwenden, um zu spezifizieren, dass nur eine der Testmethoden ausgeführt wird.</p><h4 id=ausführen-von-testskripten>Ausführen von Testskripten</h4><p>Wir führen den Test mit <code>yarn hardhat test</code> aus und können Testmethoden mit <code>yarn hardhat test --grep store</code> spezifizieren.</p><p><img src=https://image.pseudoyu.com/images/hardhat_run_tests.png alt=hardhat_run_tests></p><h3 id=hinzufügen-von-gas-reporter-unterstützung>Hinzufügen von <code>gas-reporter</code> Unterstützung</h3><p>Wie oben erwähnt, ist Gas eine Ressource, auf die wir während der Entwicklung besonders achten müssen, insbesondere teuer im Ethereum-Mainnet. Daher müssen wir den Gasverbrauch während des Testens überprüfen. HardHat hat auch ein <code>gas-reporter</code> Plugin, das bequem Gasverbrauchsinformationen ausgeben kann.</p><h4 id=installation-des-gas-reporter-plugins>Installation des <code>gas-reporter</code> Plugins</h4><p>Wir installieren das Plugin mit dem Befehl <code>yarn add --dev hardhat-gas-reporter</code>:</p><p><img src=https://image.pseudoyu.com/images/yarn_add_gas_reporter.png alt=yarn_add_gas_reporter></p><h4 id=aktivierung-der-gas-reporter-unterstützung>Aktivierung der <code>gas-reporter</code> Unterstützung</h4><p>Wir aktivieren das Plugin, indem wir <code>gasReporter: true</code> und zusätzliche Konfigurationselemente in <code>hardhat.config.js</code> hinzufügen:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;hardhat-gas-reporter&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>COINMARKETCAP_API_KEY</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>COINMARKETCAP_API_KEY</span> <span class=o>||</span> <span class=s2>&#34;key&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...,
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>gasReporter</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>enabled</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>outputFile</span><span class=o>:</span> <span class=s2>&#34;gas-reporter.txt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>noColors</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>currency</span><span class=o>:</span> <span class=s2>&#34;USD&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>coinmarketcap</span><span class=o>:</span> <span class=nx>COINMARKETCAP_API_KEY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>token</span><span class=o>:</span> <span class=s2>&#34;MATIC&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Wir können Ausgabedatei, ob Farben aktiviert werden sollen, Währung, Token-Name und CoinMarketCap API-Schlüssel angeben, um die Ausgabe gemäß dem Projekt weiter zu steuern.</p><p>Gemäß der obigen Konfiguration erzeugt die Ausführung von <code>yarn hardhat test</code> den folgenden Effekt:</p><p><img src=https://image.pseudoyu.com/images/hardhat_add_gas_reporter_support_and_export.png alt=hardhat_add_gas_reporter_support_and_export></p><h3 id=hinzufügen-von-solidity-coverage-unterstützung>Hinzufügen von <code>solidity-coverage</code> Unterstützung</h3><p>Vertragstests sind entscheidend für die Sicherstellung der Korrektheit der Geschäftslogik und der Sicherheitsvorbeugung. Daher müssen wir Abdeckungstests an Verträgen durchführen. HardHat hat auch ein <code>solidity-coverage</code> Plugin, das bequem Abdeckungsinformationen ausgeben kann.</p><h4 id=installation-des-solidity-coverage-plugins>Installation des <code>solidity-coverage</code> Plugins</h4><p>Wir installieren das Plugin mit dem Befehl <code>yarn add --dev solidity-coverage</code>:</p><p><img src=https://image.pseudoyu.com/images/yarn_add_coverage_support.png alt=yarn_add_coverage_support></p><h4 id=aktivierung-der-solidity-coverage-unterstützung>Aktivierung der <code>solidity-coverage</code> Unterstützung</h4><p>Wir müssen nur das Paket in <code>hardhat.config.js</code> importieren, um Unterstützung für Abdeckungstests hinzuzufügen:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;solidity-coverage&#34;</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=durchführung-des-abdeckungstests>Durchführung des Abdeckungstests</h4><p>Führen Sie den Abdeckungstest mit <code>yarn hardhat coverage</code> durch:</p><p><img src=https://image.pseudoyu.com/images/hardhat_coverage.png alt=hardhat_coverage></p><h3 id=aufgabe>Aufgabe</h3><p>Oben haben wir einige grundlegende Funktionen und Skripte der <code>hardhat</code> Bibliothek verwendet. Darüber hinaus können wir auch einige Aufgaben für die Entwicklung und Fehlersuche anpassen.</p><h4 id=schreiben-von-aufgaben>Schreiben von Aufgaben</h4><p>In Hardhat definieren wir Aufgaben im Verzeichnis <code>tasks</code>. Wir werden eine <code>block-number.js</code> Aufgabe schreiben, um die Blockhöhe zu erhalten:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>task</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;hardhat/config&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>task</span><span class=p>(</span><span class=s2>&#34;block-number&#34;</span><span class=p>,</span> <span class=s2>&#34;Prints the current block number&#34;</span><span class=p>).</span><span class=nx>setAction</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=p>(</span><span class=nx>taskArgs</span><span class=p>,</span> <span class=nx>hre</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>blockNumber</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>hre</span><span class=p>.</span><span class=nx>ethers</span><span class=p>.</span><span class=nx>provider</span><span class=p>.</span><span class=nx>getBlockNumber</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Current Block Number: </span><span class=si>${</span><span class=nx>blockNumber</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p>Aufgaben werden mit der Methode <code>task()</code> erstellt und die Ausführungsfunktion wird mit der Methode <code>setAction()</code> festgelegt. Hier ist <code>taskArgs</code> ein Objekt, das alle Parameter enthält, und <code>hre</code> ist ein <code>HardhatRuntimeEnvironment</code> Objekt, das verwendet werden kann, um andere Ressourcen zu erhalten.</p><h4 id=ausführen-von-aufgaben>Ausführen von Aufgaben</h4><p>Nach der Definition wird unsere neu definierte <code>block-number</code> Aufgabe in den <code>AVAILABLE TASKS</code> des Projektbefehls erscheinen. Sie können die Aufgabe mit dem Befehl <code>yarn hardhat block-number</code> ausführen. Ebenso können wir ein bestimmtes Netzwerk für die Ausführung angeben:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yarn hardhat block-number --network rinkeby
</span></span></code></pre></div><p><img src=https://image.pseudoyu.com/images/hardhat_run_tasks.png alt=hardhat_run_tasks></p><h3 id=hardhat-konsole>Hardhat Konsole</h3><p>Schließlich können wir neben der Interaktion mit der Kette/dem Vertrag durch Code auch Projekte debuggen, den Kettenstatus, Vertragseingaben und -ausgaben usw. durch die <code>Hardhat Konsole</code> einsehen. Wir können die Hardhat Konsole öffnen und mit dem Befehl <code>yarn hardhat console</code> interagieren.</p><p><img src=https://image.pseudoyu.com/images/hardhat_console.png alt=hardhat_console></p><h2 id=fazit>Fazit</h2><p>Das oben Genannte ist meine grundlegende Konfiguration und Verwendung des Hardhat-Frameworks. Es ist ein sehr leistungsfähiges Entwicklungsframework, und ich werde in Zukunft weiter in mehr seiner Funktionen und Anwendungstechniken eintauchen. Wenn Sie interessiert sind, können Sie weiterhin folgen. Ich hoffe, dies ist für alle hilfreich.</p><h2 id=referenzen>Referenzen</h2><blockquote><ol><li><a href="https://www.youtube.com/watch?v=gyMwXuJrbJQ">Learn Blockchain, Solidity, and Full Stack Web3 Development with JavaScript</a></li><li><a href=https://github.com/NomicFoundation/hardhat>NomicFoundation/hardhat</a></li><li><a href=https://hardhat.org/getting-started>Hardhat Offizielle Dokumentation</a></li><li><a href=https://www.pseudoyu.com/de/2022/05/25/learn_solidity_from_scratch_basic/>Solidity Smart Contract Entwicklung - Grundlagen</a></li><li><a href=https://www.pseudoyu.com/de/2022/05/30/learn_solidity_from_scratch_web3py/>Solidity Smart Contract Entwicklung - Beherrschung von Web3.py</a></li><li><a href=https://www.pseudoyu.com/de/2022/06/08/learn_solidity_from_scratch_ethersjs/>Solidity Smart Contract Entwicklung - Beherrschung von ethers.js</a></li></ol></blockquote></articl><h2>Verwandte Beiträge</h2><dl class=row></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl><dt class=col-md-3>2023-09-13</dt><dd class=col-md-9><a href=/de/2023/09/13/weekly_review_20230913/>Wochenrückblick #46 - Abschied von langen Haaren, ursprüngliche Intention des Wochenrückblicks und Vertragsentwicklung</a></dd></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl><dt class=col-md-3>2023-04-30</dt><dd class=col-md-9><a href=/de/2023/04/30/weekly_review_20230430/>Wochenrückblick #38 - Foundry Contract-Tests, Logseq Aufgabenverwaltung und Surge Ponte Remote-Entwicklung</a></dd></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl><dt class=col-md-3>2022-07-01</dt><dd class=col-md-9><a href=/de/2022/07/01/two_phase_commit_contract_practice_in_solidity/>Implementierung von Two-Phase Commit in Solidity Smart Contracts unter Verwendung von State Locks</a></dd></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl><dt class=col-md-3>2022-06-08</dt><dd class=col-md-9><a href=/de/2022/06/08/learn_solidity_from_scratch_ethersjs/>Solidity Smart Contract Entwicklung - Beherrschung von ethers.js</a></dd></dl></dl></dl></dl></dl></dl></dl><dt class=col-md-3>2022-05-30</dt><dd class=col-md-9><a href=/de/2022/05/30/learn_solidity_from_scratch_web3py/>Solidity Smart Contract Entwicklung - Meistern von Web3.py</a></dd></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl><div class=author-card><div class=underline></div><div class=author-box><div class=author-image><a href=https://www.pseudoyu.com><img src=/images/author.webp alt=pseudoyu></a></div><div class=author-content><p class=author-title>Autor</p><p class=author-name>pseudoyu</p><p class=author-desc>Backend- & Smart-Contract-Entwickler, MSc-Absolvent in ECIC (Electronic Commerce and Internet Computing) an der Universität Hongkong (HKU). Lerne und entwickle gerne Neues. <a href=https://github.com/pseudoyu>Folge mir auf GitHub</a></p></div></div></div><div align=center><div class=comment-underline></div></div><br><div class=comments><div class=title><span>Comments</span>
<span class=counter><span class=remark42__counter data-url=https://www.pseudoyu.com/de/2022/06/09/learn_solidity_from_scratch_hardhat/></span></span></div><div id=remark42></div></div><script>var remark_config={host:"https://comments.pseudoyu.com",site_id:"pseudoyu.com",components:["embed","counter"],max_shown_comments:20,simple_view:!0,theme:"light"}</script><script>(function(){const t=window.REMARK42;if(t)t.destroy(),t.createInstance(remark_config);else for(const t of remark_config.components){var n=document,e=n.createElement("script");e.src=`${remark_config.host}/web/${t}.mjs`,e.type="module",e.defer=!0,e.setAttribute("data-no-instant",""),n.head.appendChild(e)}})()</script></div></main><div class="footer gradient-2"><div class="container footer-container"><div class=row><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>Sitemap</div><ul class=list-unstyled><li><a href=https://www.pseudoyu.com/de/tags/>Schlagworte</a></li><li><a href=https://www.pseudoyu.com/de/categories/>Kategorien</a></li><li><a rel=alternate type=application/rss+xml href=https://www.pseudoyu.com/de/index.xml><i class="fas fa-rss-square"></i> RSS-Feed</a></li></ul></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>Social</div><ul class=list-unstyled><li><a href=https://t.me/pseudoyulife rel=noopener target=_blank>Telegram</a></li><li><a href=https://twitter.com/pseudo_yu rel=noopener target=_blank>Twitter</a></li><li><a href=https://www.instagram.com/pseudo.yu/ rel=noopener target=_blank>Instagram</a></li><li><a href=https://space.bilibili.com/5374948/ rel=noopener target=_blank>BiliBili</a></li></ul></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>Links</div><ul class=list-unstyled><li><a href=https://github.com/pseudoyu rel=noopener target=_blank>Yu's GitHub</a></li></ul></div><div class="col-xs-12 col-sm-3 col-md-3 col-lg-3"><p class="pull-right text-right"><small><em><a href="https://stats.pseudoyu.com?access-token=2m1u5i2k413q0733h2a3332w3m1t6r634g1m6n" rel=noopener target=_blank>Yu's blog analytics</a></em></small><br><small><em>Powered by <a href=https://gohugo.io rel=noopener target=_blank>Hugo</a> - <a href=https://github.com/shaform/hugo-theme-den rel=noopener target=_blank>den</a></em></small><br><small><em><a href=https://www.hku.hk rel=noopener target=_blank>The University of Hong Kong</a> - <a href=https://www.cs.hku.hk rel=noopener target=_blank>CS</a></em></small><br><small>&copy;
Yu Zhang
2020 -
2024</small></p></div><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" id=scroll-top class=scroll-top accesskey=g><span class=arrow-icon></span></a>
<script>var mybutton=document.getElementById("scroll-top");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></div></div></div><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script></body></html>